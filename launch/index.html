<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CatKitSune - Mint NFT</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}

:root{
  --primary:#14b8a6;
  --primary-dark:#0d9488;
  --bg-main:#f0fdf9;
  --border:#e5e7eb
}

body{
  font-family:Inter,sans-serif;
  background:linear-gradient(135deg,#f0fdf9 0%,#ccfbf1 100%);
  min-height:100vh;
  color:#111827
}

.container{
  max-width:1400px;
  margin:0 auto;
  padding:20px
}

/* HEADER */
header{
  background:linear-gradient(135deg,#f0fdf9 0%,#ccfbf1 100%);
  border-bottom:1px solid var(--border);
  padding:24px 0;
  position:sticky;
  top:0;
  z-index:100
}

.header-content{
  max-width:1400px;
  margin:0 auto;
  padding:0 20px;
  display:flex;
  justify-content:space-between;
  align-items:center
}

/* LOGO */
.logo{
  display:flex;
  align-items:center;
  text-decoration:none
}

.logo-img{
  height:88px;
  width:auto;
  display:block
}

/* BACK BUTTON */
.back-btn{
  padding:12px 22px;
  background:var(--primary);
  color:#fff;
  border-radius:14px;
  text-decoration:none;
  font-weight:700;
  transition:.3s
}
.back-btn:hover{
  opacity:.9;
  transform:translateY(-2px)
}

/* SUPPLY BANNER */
.supply-banner{
  background:linear-gradient(135deg,#667eea,#764ba2);
  padding:24px 32px;
  border-radius:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:32px
}
.supply-count{
  font-size:36px;
  font-weight:900;
  color:#fff
}
.progress-container{flex:1;margin:0 32px}
.progress-bar{
  height:14px;
  background:rgba(255,255,255,.2);
  border-radius:999px;
  overflow:hidden
}
.progress-fill{
  height:100%;
  background:linear-gradient(90deg,#10b981,#22c55e);
  width:0%;
  transition:width 0.5s ease
}
.progress-text{
  color:#fff;
  font-size:13px;
  text-align:center;
  margin-top:8px;
  font-weight:600
}
.status-badge{
  background:rgba(255,255,255,.25);
  padding:12px 24px;
  border-radius:999px;
  color:#fff;
  font-weight:700
}

/* LAYOUT */
.mint-section{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:32px
}
@media(max-width:1024px){
  .mint-section{grid-template-columns:1fr}
}

.nft-preview,.mint-card{
  background:#fff;
  border-radius:24px;
  padding:32px;
  box-shadow:0 10px 40px rgba(0,0,0,.08)
}

/* NFT GRID */
.nft-grid-container{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px
}
.nft-grid-container img{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  border-radius:16px
}

/* MINT CARD */
.mint-card h1{font-size:32px;margin-bottom:8px}
.mint-card h2{
  font-size:36px;
  font-weight:900;
  color:var(--primary);
  margin-bottom:24px
}

/* MINT BUTTON */
.mint-button{
  width:100%;
  padding:20px;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#fff;
  border:none;
  border-radius:16px;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
  transition:all 0.3s ease;
}

.mint-button:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 24px rgba(20,184,166,0.4);
}

.mint-button:disabled{
  opacity:0.6;
  cursor:not-allowed;
  transform:none;
}

/* DEBUG */
.debug-info{
  margin-top:24px;
  padding:20px;
  background:#f9fafb;
  border-radius:16px;
  font-size:11px;
  font-family:monospace;
  max-height:300px;
  overflow:auto;
}

.debug-log{
  margin:4px 0;
  padding:4px 8px;
  border-left:3px solid #14b8a6;
}

.debug-error{
  border-left-color:#ef4444;
  background:#fee;
  color:#dc2626;
}

.debug-success{
  border-left-color:#10b981;
  background:#d1fae5;
  color:#059669;
}
</style>
</head>

<body>

<header>
  <div class="header-content">
    <a href="/" class="logo">
      <img src="https://kephost.net/p/MjI3NDg0NQ.png" alt="CatKitSune" class="logo-img">
    </a>
    <a class="back-btn" href="/">‚Üê Back</a>
  </div>
</header>

<div class="container">

<div class="supply-banner">
  <div>
    <div style="color:#fff;opacity:.8;font-size:14px">Minted</div>
    <div class="supply-count" id="supplyCount">‚Äî / 300</div>
  </div>
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-text" id="progressText">Loading‚Ä¶</div>
  </div>
  <div class="status-badge">üî• Minting Live</div>
</div>

<div class="mint-section">

<div class="nft-preview">
  <div class="nft-grid-container">
    <img src="/launch/1.png" alt="NFT 1">
    <img src="/launch/2.png" alt="NFT 2">
    <img src="/launch/3.png" alt="NFT 3">
    <img src="/launch/4.png" alt="NFT 4">
    <img src="/launch/5.png" alt="NFT 5">
    <img src="/launch/6.png" alt="NFT 6">
    <img src="/launch/7.png" alt="NFT 7">
    <img src="/launch/8.png" alt="NFT 8">
    <img src="/launch/9.png" alt="NFT 9">
  </div>
</div>

<div class="mint-card">
  <h1>üî• Mint Your NFT</h1>
  <h2>0.1 HYPE</h2>
  <button class="mint-button" id="mintButton">Connect Wallet</button>
  <div class="debug-info" id="debugInfo">
    <div class="debug-log">Waiting for wallet connection...</div>
  </div>
</div>

</div>
</div>

<script>
// ===========================
// HYPERLIQUID CONFIG
// ===========================
const HYPERLIQUID_CONFIG = {
  chainId: '0x6665CC1D', // 1721453597 decimal
  chainName: 'Hyperliquid',
  rpcUrls: ['https://api.hyperliquid-testnet.xyz/evm'],
  nativeCurrency: {
    name: 'HYPE',
    symbol: 'HYPE',
    decimals: 18
  },
  blockExplorerUrls: ['https://explorer.hyperliquid-testnet.xyz']
};

// CONTRACT ADDRESS - CSER√âLD KI A SAJ√ÅTODRA!
const CONTRACT_ADDRESS = '0xYourContractAddressHere';

// SIMPLIFIED ABI - csak a sz√ºks√©ges funkci√≥k
const CONTRACT_ABI = [
  'function mint() public payable',
  'function totalSupply() public view returns (uint256)',
  'function MAX_SUPPLY() public view returns (uint256)'
];

// MINT √ÅR (0.1 HYPE)
const MINT_PRICE = ethers.utils.parseEther('0.1');

// ===========================
// GLOB√ÅLIS V√ÅLTOZ√ìK
// ===========================
let provider = null;
let signer = null;
let contract = null;
let userAddress = null;

// ===========================
// DEBUG LOGGING
// ===========================
function log(message, type = 'info') {
  const debugDiv = document.getElementById('debugInfo');
  const logClass = type === 'error' ? 'debug-error' : type === 'success' ? 'debug-success' : 'debug-log';
  const timestamp = new Date().toLocaleTimeString();
  debugDiv.innerHTML += `<div class="${logClass}">[${timestamp}] ${message}</div>`;
  debugDiv.scrollTop = debugDiv.scrollHeight;
  console.log(`[${type.toUpperCase()}] ${message}`);
}

// ===========================
// WALLET CONNECTION
// ===========================
async function connectWallet() {
  try {
    log('Checking for MetaMask...');
    
    // MetaMask ellen≈ërz√©s
    if (typeof window.ethereum === 'undefined') {
      throw new Error('MetaMask not installed! Please install MetaMask extension.');
    }

    log('MetaMask detected, requesting accounts...');
    
    // Fi√≥kok lek√©r√©se
    const accounts = await window.ethereum.request({ 
      method: 'eth_requestAccounts' 
    });
    
    userAddress = accounts[0];
    log(`Connected: ${userAddress.substring(0, 6)}...${userAddress.substring(38)}`, 'success');

    // Provider √©s signer inicializ√°l√°s
    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();

    // H√°l√≥zat ellen≈ërz√©s
    const network = await provider.getNetwork();
    log(`Current network: ${network.name} (${network.chainId})`);

    // Ha nem Hyperliquid, akkor v√°lt√°s
    if (network.chainId !== parseInt(HYPERLIQUID_CONFIG.chainId, 16)) {
      log('Wrong network! Switching to Hyperliquid...');
      await switchToHyperliquid();
    } else {
      log('Already on Hyperliquid network!', 'success');
    }

    // Contract inicializ√°l√°s
    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
    log('Contract initialized', 'success');

    // UI friss√≠t√©s
    updateButtonState('connected');
    await loadSupplyData();

  } catch (error) {
    log(`Connection error: ${error.message}`, 'error');
    alert(`Connection failed: ${error.message}`);
  }
}

// ===========================
// NETWORK SWITCHING
// ===========================
async function switchToHyperliquid() {
  try {
    await window.ethereum.request({
      method: 'wallet_switchEthereumChain',
      params: [{ chainId: HYPERLIQUID_CONFIG.chainId }],
    });
    log('Switched to Hyperliquid!', 'success');
  } catch (switchError) {
    // Ha a h√°l√≥zat m√©g nincs hozz√°adva
    if (switchError.code === 4902) {
      log('Hyperliquid not found, adding network...');
      try {
        await window.ethereum.request({
          method: 'wallet_addEthereumChain',
          params: [{
            chainId: HYPERLIQUID_CONFIG.chainId,
            chainName: HYPERLIQUID_CONFIG.chainName,
            rpcUrls: HYPERLIQUID_CONFIG.rpcUrls,
            nativeCurrency: HYPERLIQUID_CONFIG.nativeCurrency,
            blockExplorerUrls: HYPERLIQUID_CONFIG.blockExplorerUrls
          }]
        });
        log('Hyperliquid network added!', 'success');
      } catch (addError) {
        throw new Error(`Failed to add Hyperliquid network: ${addError.message}`);
      }
    } else {
      throw switchError;
    }
  }
}

// ===========================
// SUPPLY DATA
// ===========================
async function loadSupplyData() {
  try {
    log('Loading supply data...');
    
    const totalSupply = await contract.totalSupply();
    const maxSupply = await contract.MAX_SUPPLY();
    
    const minted = totalSupply.toNumber();
    const max = maxSupply.toNumber();
    const percentage = (minted / max) * 100;

    document.getElementById('supplyCount').textContent = `${minted} / ${max}`;
    document.getElementById('progressFill').style.width = `${percentage}%`;
    document.getElementById('progressText').textContent = `${percentage.toFixed(1)}% minted`;

    log(`Supply: ${minted}/${max} (${percentage.toFixed(1)}%)`, 'success');

  } catch (error) {
    log(`Failed to load supply: ${error.message}`, 'error');
    document.getElementById('supplyCount').textContent = '‚Äî / 300';
  }
}

// ===========================
// MINTING
// ===========================
async function mintNFT() {
  if (!contract || !signer) {
    log('Wallet not connected!', 'error');
    return;
  }

  try {
    log('Starting mint transaction...');
    updateButtonState('minting');

    // Gas estimation
    const gasEstimate = await contract.estimateGas.mint({ value: MINT_PRICE });
    log(`Estimated gas: ${gasEstimate.toString()}`);

    // Mint transaction
    const tx = await contract.mint({ 
      value: MINT_PRICE,
      gasLimit: gasEstimate.mul(120).div(100) // 20% buffer
    });

    log(`Transaction sent: ${tx.hash}`);
    log('Waiting for confirmation...');

    const receipt = await tx.wait();
    
    log(`Minted successfully! Block: ${receipt.blockNumber}`, 'success');
    log(`Transaction: ${tx.hash}`, 'success');

    // Supply friss√≠t√©s
    await loadSupplyData();
    
    updateButtonState('connected');
    alert('üéâ NFT successfully minted!');

  } catch (error) {
    log(`Mint failed: ${error.message}`, 'error');
    
    if (error.code === 4001) {
      alert('Transaction cancelled by user');
    } else if (error.message.includes('insufficient funds')) {
      alert('Insufficient HYPE balance. You need 0.1 HYPE + gas fees.');
    } else {
      alert(`Minting failed: ${error.message}`);
    }
    
    updateButtonState('connected');
  }
}

// ===========================
// BUTTON STATE MANAGEMENT
// ===========================
function updateButtonState(state) {
  const button = document.getElementById('mintButton');
  
  switch(state) {
    case 'connected':
      button.textContent = 'üî• Mint Now (0.1 HYPE)';
      button.disabled = false;
      button.onclick = mintNFT;
      break;
    case 'minting':
      button.textContent = '‚è≥ Minting...';
      button.disabled = true;
      break;
    default:
      button.textContent = 'Connect Wallet';
      button.disabled = false;
      button.onclick = connectWallet;
  }
}

// ===========================
// EVENT LISTENERS
// ===========================
document.getElementById('mintButton').addEventListener('click', connectWallet);

// H√°l√≥zatv√°lt√°s figyel√©s
if (window.ethereum) {
  window.ethereum.on('chainChanged', () => {
    log('Network changed, reloading...');
    window.location.reload();
  });

  window.ethereum.on('accountsChanged', (accounts) => {
    if (accounts.length === 0) {
      log('Wallet disconnected', 'error');
      updateButtonState('disconnected');
    } else {
      log('Account changed, reloading...');
      window.location.reload();
    }
  });
}

// ===========================
// INITIAL LOAD
// ===========================
window.addEventListener('load', () => {
  log('Page loaded, ready to connect wallet');
  
  // Ha m√°r csatlakoztatva van MetaMask
  if (window.ethereum && window.ethereum.selectedAddress) {
    log('Previous connection detected, auto-connecting...');
    connectWallet();
  }
});
</script>

</body>
</html>
