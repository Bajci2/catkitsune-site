<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CatKitSune - Mint Your NFT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .logo {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .info-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.1em;
        }

        .info-label {
            font-weight: bold;
        }

        .wallet-section {
            margin-bottom: 30px;
        }

        .wallet-address {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            word-break: break-all;
            font-family: monospace;
            color: #333;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .quantity-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }

        .quantity-btn {
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            padding: 0;
            border-radius: 50%;
        }

        .quantity-display {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            min-width: 60px;
        }

        .total-price {
            font-size: 1.5em;
            color: #764ba2;
            font-weight: bold;
            margin: 20px 0;
        }

        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            background: #fff3cd;
            color: #856404;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            .subtitle {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="1.png" alt="CatKitSune Logo" class="logo">
        <h1>CatKitSune NFT</h1>
        <p class="subtitle">Mint Your Exclusive NFT</p>

        <div class="info-box">
            <div class="info-item">
                <span class="info-label">Total Supply:</span>
                <span>300</span>
            </div>
            <div class="info-item">
                <span class="info-label">Available:</span>
                <span id="available">300</span>
            </div>
            <div class="info-item">
                <span class="info-label">Price:</span>
                <span>0.5 HYPE</span>
            </div>
        </div>

        <div class="wallet-section">
            <button id="connectWallet">Connect Wallet</button>
            <div id="walletInfo" style="display: none;">
                <div class="wallet-address" id="walletAddress"></div>
            </div>
        </div>

        <div id="mintSection" style="display: none;">
            <div class="quantity-selector">
                <button class="quantity-btn" id="decreaseBtn">-</button>
                <span class="quantity-display" id="quantity">1</span>
                <button class="quantity-btn" id="increaseBtn">+</button>
            </div>
            <div class="total-price">
                Total: <span id="totalPrice">0.5</span> HYPE
            </div>
            <button id="mintBtn">Mint NFT</button>
        </div>

        <div id="statusMessage"></div>
    </div>

    <script type="module">
        // üß™ TEST MODE - V√°ltoztasd "LIVE"-ra az √©les ind√≠t√°shoz!
        const MODE = "TEST"; // TEST | LIVE
        
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js';

        // Firebase konfigur√°ci√≥
        const firebaseConfig = {
            apiKey: "AIzaSyCn99m_Ylo5In_eram3HHol-AV9d2MdnNs",
            authDomain: "catkitsune-d2acc.firebaseapp.com",
            databaseURL: "https://catkitsune-d2acc-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "catkitsune-d2acc",
            storageBucket: "catkitsune-d2acc.firebasestorage.app",
            messagingSenderId: "21305297418",
            appId: "1:21305297418:web:4d2a83d9a7a9f49ea49bb7",
            measurementId: "G-58Z7Z4DZN0"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Smart contract / Wallet konfigur√°ci√≥
        const TREASURY_ADDRESS = "0x73C4e88f22c53a02791C64D647C4E0ee011b86C5"; // TE C√çMED - ahol a p√©nz gy≈±lik
        const PRICE_PER_NFT = "0.5"; // HYPE
        const MAX_SUPPLY = 300;
        const HYPERLIQUID_CHAIN_ID = "0x3e6"; // 998 decim√°lisan (Testnet)
        // const HYPERLIQUID_CHAIN_ID = "0x101b9"; // 66001 decim√°lisan (Mainnet) - haszn√°ld majd √©lesben!

        let currentAccount = null;
        let quantity = 1;
        const PRICE = 0.5;

        console.log("üöÄ CatKitSune Minting App inicializ√°lva");
        console.log("üß™ MODE:", MODE);
        console.log("üí∞ Treasury Address:", TREASURY_ADDRESS);

        // Firebase listener - el√©rhet≈ë NFT-k sz√°ma
        const availableRef = ref(database, 'nft/available');
        onValue(availableRef, (snapshot) => {
            const available = snapshot.val() || MAX_SUPPLY;
            document.getElementById('available').textContent = available;
            console.log("üìä El√©rhet≈ë NFT-k:", available);
        });

        // H√°l√≥zat ellen≈ërz√©se
        async function checkNetwork() {
            try {
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                console.log("üåê Jelenlegi h√°l√≥zat Chain ID:", chainId, "(", parseInt(chainId, 16), "decim√°lisan)");
                
                if (chainId !== HYPERLIQUID_CHAIN_ID) {
                    console.warn("‚ö†Ô∏è Rossz h√°l√≥zat! V√°rt:", HYPERLIQUID_CHAIN_ID, "Jelenlegi:", chainId);
                    showStatus('‚ö†Ô∏è K√©rlek v√°ltsd √°t a h√°l√≥zatot Hyperliquid-re!', 'error');
                    
                    // Pr√≥b√°ld meg automatikusan v√°ltani
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: HYPERLIQUID_CHAIN_ID }],
                        });
                        console.log("‚úÖ H√°l√≥zat sikeresen √°tv√°ltva!");
                        return true;
                    } catch (switchError) {
                        console.error("‚ùå H√°l√≥zat v√°lt√°si hiba:", switchError);
                        // Ha nincs hozz√°adva a h√°l√≥zat
                        if (switchError.code === 4902) {
                            showStatus('Hyperliquid h√°l√≥zat hozz√°ad√°sa sz√ºks√©ges a MetaMask-ban!', 'error');
                        }
                    }
                    return false;
                }
                console.log("‚úÖ Helyes h√°l√≥zaton vagy!");
                return true;
            } catch (error) {
                console.error("‚ùå H√°l√≥zat ellen≈ërz√©si hiba:", error);
                return false;
            }
        }

        // Wallet csatlakoztat√°s
        document.getElementById('connectWallet').addEventListener('click', async () => {
            console.log("üîå Connect Wallet gomb megnyomva");
            
            if (typeof window.ethereum === 'undefined') {
                console.error("‚ùå MetaMask nem tal√°lhat√≥!");
                showStatus('K√©rlek telep√≠tsd a MetaMask-ot!', 'error');
                return;
            }

            try {
                // El≈ësz√∂r ellen≈ërizz√ºk a h√°l√≥zatot
                const networkOk = await checkNetwork();
                if (!networkOk && MODE === "LIVE") {
                    console.warn("‚ö†Ô∏è LIVE m√≥dban helyes h√°l√≥zat sz√ºks√©ges!");
                    return; // LIVE m√≥dban k√∂telez≈ë a helyes h√°l√≥zat
                }

                console.log("üìû Wallet csatlakoz√°s k√©r√©se...");
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                currentAccount = accounts[0];
                console.log("‚úÖ Wallet csatlakoztatva:", currentAccount);

                // TEST MODE ellen≈ërz√©s
                if (MODE === "TEST") {
                    console.log("üß™ TEST MODE AKT√çV - Tranzakci√≥k nem ker√ºlnek elk√ºld√©sre!");
                    alert(
                        "üß™ TEST MODE AKT√çV!\n\n" +
                        "‚úÖ Wallet csatlakoztatva:\n" + currentAccount + "\n\n" +
                        "‚ö†Ô∏è Tranzakci√≥k NEM ker√ºlnek elk√ºld√©sre!\n" +
                        "üí∞ P√©nz c√©lc√≠me: " + TREASURY_ADDRESS
                    );
                    
                    document.getElementById('walletAddress').textContent = currentAccount;
                    document.getElementById('walletInfo').style.display = 'block';
                    document.getElementById('connectWallet').style.display = 'none';
                    document.getElementById('mintSection').style.display = 'block';
                    showStatus('üß™ TEST MODE: Wallet connected - Nincs val√≥di tranzakci√≥', 'loading');
                    return;
                }

                // LIVE MODE
                console.log("üî¥ LIVE MODE - Val√≥di tranzakci√≥k!");
                document.getElementById('walletAddress').textContent = currentAccount;
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('connectWallet').style.display = 'none';
                document.getElementById('mintSection').style.display = 'block';
                showStatus('Wallet sikeresen csatlakoztatva!', 'success');
            } catch (error) {
                console.error("‚ùå Wallet csatlakoztat√°si hiba:", error);
                showStatus('Wallet csatlakoztat√°s sikertelen: ' + error.message, 'error');
            }
        });

        // Mennyis√©g kezel√©se
        document.getElementById('decreaseBtn').addEventListener('click', () => {
            if (quantity > 1) {
                quantity--;
                updateQuantityDisplay();
                console.log("‚ûñ Mennyis√©g cs√∂kkentve:", quantity);
            }
        });

        document.getElementById('increaseBtn').addEventListener('click', () => {
            const available = parseInt(document.getElementById('available').textContent);
            if (quantity < Math.min(10, available)) {
                quantity++;
                updateQuantityDisplay();
                console.log("‚ûï Mennyis√©g n√∂velve:", quantity);
            }
        });

        function updateQuantityDisplay() {
            document.getElementById('quantity').textContent = quantity;
            document.getElementById('totalPrice').textContent = (PRICE * quantity).toFixed(1);
        }

        // Minting
        document.getElementById('mintBtn').addEventListener('click', async () => {
            console.log("üé® Mint gomb megnyomva");
            
            if (!currentAccount) {
                console.error("‚ùå Nincs csatlakoztatott wallet!");
                showStatus('El≈ësz√∂r csatlakoztasd a wallet-ot!', 'error');
                return;
            }

            // TEST MODE ellen≈ërz√©s
            if (MODE === "TEST") {
                console.log("üß™ TEST MODE: Mint szimul√°ci√≥");
                console.log("üìä R√©szletek:");
                console.log("  - Mennyis√©g:", quantity, "NFT");
                console.log("  - √År:", (PRICE * quantity).toFixed(1), "HYPE");
                console.log("  - C√©lc√≠m:", TREASURY_ADDRESS);
                console.log("  - Felhaszn√°l√≥:", currentAccount);
                
                alert(
                    "üß™ TEST MODE:\n" +
                    "Tranzakci√≥ NEM ker√ºlt elk√ºld√©sre!\n\n" +
                    "üìä R√âSZLETEK:\n" +
                    "‚Ä¢ Mennyis√©g: " + quantity + " NFT\n" +
                    "‚Ä¢ √År: " + (PRICE * quantity).toFixed(1) + " HYPE\n" +
                    "‚Ä¢ C√©lc√≠m: " + TREASURY_ADDRESS + "\n\n" +
                    "‚úÖ Minden rendben m≈±k√∂dik!\n" +
                    "‚ö†Ô∏è √âles m√≥dban (LIVE) ez val√≥di tranzakci√≥ lenne."
                );
                
                showStatus('üß™ TEST MODE: Tranzakci√≥ szimul√°lva!', 'success');
                return;
            }

            // LIVE MODE - Val√≥di tranzakci√≥
            console.log("üî¥ LIVE MODE: Val√≥di tranzakci√≥ k√ºld√©se!");
            try {
                showStatus('Tranzakci√≥ feldolgoz√°sa...', 'loading');

                // Ellen≈ërizz√ºk √∫jra a h√°l√≥zatot
                const networkOk = await checkNetwork();
                if (!networkOk) {
                    console.error("‚ùå Rossz h√°l√≥zat!");
                    showStatus('Rossz h√°l√≥zat! V√°ltsd Hyperliquid-re!', 'error');
                    return;
                }

                const totalPrice = (PRICE * quantity).toFixed(18);
                const valueInHex = '0x' + (BigInt(Math.floor(parseFloat(totalPrice) * 1e18))).toString(16);

                console.log("üí∏ Tranzakci√≥ k√ºld√©se:");
                console.log("  - To:", TREASURY_ADDRESS);
                console.log("  - From:", currentAccount);
                console.log("  - Value:", valueInHex, "(", totalPrice, "HYPE)");
                console.log("  - Quantity:", quantity);

                // Egyszer≈± HYPE k√ºld√©s a treasury c√≠mre
                const transactionParameters = {
                    to: TREASURY_ADDRESS,
                    from: currentAccount,
                    value: valueInHex,
                };

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParameters],
                });

                console.log("‚úÖ Tranzakci√≥ elk√ºldve! Hash:", txHash);
                showStatus('‚úÖ Sikeres! TX: ' + txHash.substring(0, 10) + '...', 'success');
                
                alert(
                    "‚úÖ SIKERES MINTING!\n\n" +
                    "Tranzakci√≥ hash:\n" + txHash + "\n\n" +
                    "‚ö†Ô∏è Az NFT-t manu√°lisan kell kik√ºldeni!\n" +
                    "Mennyis√©g: " + quantity + " NFT"
                );

            } catch (error) {
                console.error("‚ùå Minting hiba:", error);
                showStatus('‚ùå Hiba: ' + error.message, 'error');
            }
        });

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status-message ' + type;
            statusDiv.style.display = 'block';
            console.log("üì¢ Status:", type, "-", message);
        }

        console.log("‚úÖ Script bet√∂ltve √©s inicializ√°lva!");
    </script>
</body>
</html>
