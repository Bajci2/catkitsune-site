<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CatKitSune - NFT Minting</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5em;
            font-weight: bold;
            color: #00bcd4;
        }

        .back-btn {
            background: #00bcd4;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #0097a7;
            transform: translateY(-2px);
        }

        .status-banner {
            background: linear-gradient(135deg, #7b68ee 0%, #9370db 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .status-info {
            font-size: 1.2em;
        }

        .status-number {
            font-size: 2em;
            font-weight: bold;
        }

        .progress-bar {
            flex: 1;
            margin: 0 30px;
            height: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.5s ease;
        }

        .status-badge {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .nft-showcase {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .nft-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .nft-item {
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .nft-item:hover {
            transform: scale(1.05);
        }

        .nft-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .nft-info {
            text-align: center;
        }

        .nft-title {
            font-size: 1.5em;
            color: #00bcd4;
            margin-bottom: 10px;
        }

        .nft-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .nft-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            color: #999;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00bcd4;
        }

        .mint-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .mint-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .mint-subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .quantity-section {
            margin-bottom: 20px;
        }

        .section-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
        }

        .quantity-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #00bcd4;
            background: white;
            color: #00bcd4;
            font-size: 1.5em;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: #00bcd4;
            color: white;
        }

        .quantity-display {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            min-width: 50px;
            text-align: center;
        }

        .price-box {
            background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .price-amount {
            font-size: 2em;
            font-weight: bold;
        }

        .connect-btn {
            background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%);
            color: white;
            padding: 20px;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,188,212,0.3);
        }

        .connect-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .wallet-info {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            word-break: break-all;
            font-family: monospace;
            font-size: 0.9em;
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-message.loading {
            background: #fff3cd;
            color: #856404;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .nft-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .status-banner {
                flex-direction: column;
                gap: 15px;
            }

            .progress-bar {
                margin: 15px 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            üê± CatKitSune
        </div>
        <a href="../index.html" class="back-btn">‚Üê Back to Home</a>
    </div>

    <div class="status-banner">
        <div class="status-info">
            <div style="opacity: 0.8; font-size: 0.8em;">Available to Mint</div>
            <div class="status-number"><span id="mintedCount">0</span> / <span id="totalSupply">300</span></div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        <div class="status-badge">
            ‚≠ê Coming Soon
        </div>
    </div>

    <div class="container">
        <div class="nft-showcase">
            <div class="nft-grid">
                <div class="nft-item">
                    <img src="1.png" alt="NFT 1">
                </div>
                <div class="nft-item">
                    <img src="2.png" alt="NFT 2">
                </div>
                <div class="nft-item">
                    <img src="3.png" alt="NFT 3">
                </div>
                <div class="nft-item">
                    <img src="4.png" alt="NFT 4">
                </div>
                <div class="nft-item">
                    <img src="5.png" alt="NFT 5">
                </div>
                <div class="nft-item">
                    <img src="6.png" alt="NFT 6">
                </div>
                <div class="nft-item">
                    <img src="7.png" alt="NFT 7">
                </div>
                <div class="nft-item">
                    <img src="8.png" alt="NFT 8">
                </div>
                <div class="nft-item">
                    <img src="9.png" alt="NFT 9">
                </div>
            </div>

            <div class="nft-info">
                <h2 class="nft-title">CatKitSune NFT</h2>
                <p class="nft-description">
                    Join the CatKitSune ecosystem! Each NFT grants you access to exclusive rewards,
                    staking benefits, and governance rights. Be part of the revolution on Hyperliquid!
                </p>

                <div class="nft-stats">
                    <div class="stat-item">
                        <div class="stat-label">Supply</div>
                        <div class="stat-value">300</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Price</div>
                        <div class="stat-value">0.5 HYPE</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Royalty</div>
                        <div class="stat-value">5%</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mint-panel">
            <h2 class="mint-title">üî• Mint Your NFT</h2>
            <p class="mint-subtitle">Select quantity and connect your wallet to mint</p>

            <div class="quantity-section">
                <div class="section-label">Quantity</div>
                <div class="quantity-selector">
                    <button class="quantity-btn" id="decreaseBtn">-</button>
                    <div class="quantity-display" id="quantity">1</div>
                    <button class="quantity-btn" id="increaseBtn">+</button>
                </div>
            </div>

            <div class="section-label">Total Price</div>
            <div class="price-box">
                <div class="price-label">You will pay</div>
                <div class="price-amount"><span id="totalPrice">0.5</span> HYPE üíé</div>
            </div>

            <div id="walletSection">
                <button class="connect-btn" id="connectBtn">Connect Wallet to Mint</button>
                <div id="walletInfo" style="display: none;"></div>
            </div>

            <div id="statusMessage"></div>
        </div>
    </div>

    <script type="module">
        // üß™ TEST MODE - V√°ltoztasd "LIVE"-ra az √©les ind√≠t√°shoz!
        const MODE = "TEST"; // TEST | LIVE
        
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js';

        // Firebase konfigur√°ci√≥
        const firebaseConfig = {
            apiKey: "AIzaSyCn99m_Ylo5In_eram3HHol-AV9d2MdnNs",
            authDomain: "catkitsune-d2acc.firebaseapp.com",
            databaseURL: "https://catkitsune-d2acc-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "catkitsune-d2acc",
            storageBucket: "catkitsune-d2acc.firebasestorage.app",
            messagingSenderId: "21305297418",
            appId: "1:21305297418:web:4d2a83d9a7a9f49ea49bb7",
            measurementId: "G-58Z7Z4DZN0"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Smart contract / Wallet konfigur√°ci√≥
        const TREASURY_ADDRESS = "0x73C4e88f22c53a02791C64D647C4E0ee011b86C5"; // TE C√çMED
        const PRICE_PER_NFT = 0.5;
        const MAX_SUPPLY = 300;
        const HYPERLIQUID_CHAIN_ID = "0x3e6"; // 998 (Testnet)

        let currentAccount = null;
        let quantity = 1;

        console.log("üöÄ CatKitSune Minting App inicializ√°lva");
        console.log("üß™ MODE:", MODE);
        console.log("üí∞ Treasury Address:", TREASURY_ADDRESS);

        // Firebase listener
        const availableRef = ref(database, 'nft/available');
        onValue(availableRef, (snapshot) => {
            const available = snapshot.val() || MAX_SUPPLY;
            const minted = MAX_SUPPLY - available;
            document.getElementById('mintedCount').textContent = minted;
            document.getElementById('totalSupply').textContent = MAX_SUPPLY;
            
            const progress = (minted / MAX_SUPPLY) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            console.log("üìä Minted:", minted, "/ Available:", available);
        });

        // H√°l√≥zat ellen≈ërz√©se
        async function checkNetwork() {
            try {
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                console.log("üåê Chain ID:", chainId);
                
                if (chainId !== HYPERLIQUID_CHAIN_ID) {
                    showStatus('‚ö†Ô∏è K√©rlek v√°ltsd √°t a h√°l√≥zatot Hyperliquid-re!', 'error');
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: HYPERLIQUID_CHAIN_ID }],
                        });
                        return true;
                    } catch (switchError) {
                        console.error("‚ùå H√°l√≥zat v√°lt√°si hiba:", switchError);
                        return false;
                    }
                }
                return true;
            } catch (error) {
                console.error("‚ùå H√°l√≥zat ellen≈ërz√©si hiba:", error);
                return false;
            }
        }

        // Quantity selector
        document.getElementById('decreaseBtn').addEventListener('click', () => {
            if (quantity > 1) {
                quantity--;
                updateDisplay();
            }
        });

        document.getElementById('increaseBtn').addEventListener('click', () => {
            if (quantity < 10) {
                quantity++;
                updateDisplay();
            }
        });

        function updateDisplay() {
            document.getElementById('quantity').textContent = quantity;
            document.getElementById('totalPrice').textContent = (PRICE_PER_NFT * quantity).toFixed(1);
        }

        // Connect Wallet
        document.getElementById('connectBtn').addEventListener('click', async () => {
            console.log("üîå Connect Wallet gomb megnyomva");
            
            if (typeof window.ethereum === 'undefined') {
                showStatus('K√©rlek telep√≠tsd a MetaMask-ot!', 'error');
                return;
            }

            try {
                const networkOk = await checkNetwork();
                if (!networkOk && MODE === "LIVE") {
                    return;
                }

                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                currentAccount = accounts[0];
                console.log("‚úÖ Wallet csatlakoztatva:", currentAccount);

                // TEST MODE
                if (MODE === "TEST") {
                    alert(
                        "üß™ TEST MODE AKT√çV!\n\n" +
                        "‚úÖ Wallet: " + currentAccount + "\n\n" +
                        "‚ö†Ô∏è Tranzakci√≥k NEM ker√ºlnek elk√ºld√©sre!\n" +
                        "üí∞ C√©lc√≠m: " + TREASURY_ADDRESS
                    );
                    
                    document.getElementById('walletInfo').innerHTML = 
                        `<div class="wallet-info">Connected: ${currentAccount}</div>`;
                    document.getElementById('walletInfo').style.display = 'block';
                    document.getElementById('connectBtn').textContent = 'Mint NFT';
                    document.getElementById('connectBtn').onclick = mintNFT;
                    showStatus('üß™ TEST MODE: Wallet connected', 'loading');
                    return;
                }

                // LIVE MODE
                document.getElementById('walletInfo').innerHTML = 
                    `<div class="wallet-info">Connected: ${currentAccount}</div>`;
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('connectBtn').textContent = 'Mint NFT';
                document.getElementById('connectBtn').onclick = mintNFT;
                showStatus('Wallet sikeresen csatlakoztatva!', 'success');
            } catch (error) {
                console.error("‚ùå Wallet hiba:", error);
                showStatus('Wallet csatlakoztat√°s sikertelen: ' + error.message, 'error');
            }
        });

        // Mint NFT
        async function mintNFT() {
            console.log("üé® Mint NFT gomb megnyomva");
            
            if (!currentAccount) {
                showStatus('El≈ësz√∂r csatlakoztasd a wallet-ot!', 'error');
                return;
            }

            // TEST MODE
            if (MODE === "TEST") {
                console.log("üß™ TEST MODE: Mint szimul√°ci√≥");
                console.log("  - Mennyis√©g:", quantity);
                console.log("  - √År:", (PRICE_PER_NFT * quantity).toFixed(1), "HYPE");
                console.log("  - C√©lc√≠m:", TREASURY_ADDRESS);
                
                alert(
                    "üß™ TEST MODE:\n" +
                    "Tranzakci√≥ NEM ker√ºlt elk√ºld√©sre!\n\n" +
                    "üìä R√âSZLETEK:\n" +
                    "‚Ä¢ Mennyis√©g: " + quantity + " NFT\n" +
                    "‚Ä¢ √År: " + (PRICE_PER_NFT * quantity).toFixed(1) + " HYPE\n" +
                    "‚Ä¢ C√©lc√≠m: " + TREASURY_ADDRESS + "\n\n" +
                    "‚úÖ Minden rendben m≈±k√∂dik!"
                );
                
                showStatus('üß™ TEST MODE: Tranzakci√≥ szimul√°lva!', 'success');
                return;
            }

            // LIVE MODE
            try {
                showStatus('Tranzakci√≥ feldolgoz√°sa...', 'loading');

                const networkOk = await checkNetwork();
                if (!networkOk) {
                    showStatus('Rossz h√°l√≥zat!', 'error');
                    return;
                }

                const totalPrice = (PRICE_PER_NFT * quantity).toFixed(18);
                const valueInHex = '0x' + (BigInt(Math.floor(parseFloat(totalPrice) * 1e18))).toString(16);

                const transactionParameters = {
                    to: TREASURY_ADDRESS,
                    from: currentAccount,
                    value: valueInHex,
                };

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParameters],
                });

                console.log("‚úÖ TX:", txHash);
                showStatus('‚úÖ Sikeres! TX: ' + txHash.substring(0, 10) + '...', 'success');
                
                alert("‚úÖ SIKERES MINTING!\n\nTX: " + txHash);

            } catch (error) {
                console.error("‚ùå Minting hiba:", error);
                showStatus('‚ùå Hiba: ' + error.message, 'error');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status-message ' + type;
            statusDiv.style.display = 'block';
        }
    </script>
</body>
</html>
