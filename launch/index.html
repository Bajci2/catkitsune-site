<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CatKitSune - Mint NFT</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  --primary: #000000;
  --secondary: #3b82f6;
  --accent: #8b5cf6;
  --bg-main: #ffffff;
  --bg-card: #fafafa;
  --border: #e5e7eb;
  --text-primary: #111827;
  --text-secondary: #6b7280;
  --text-muted: #9ca3af;
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
  --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
  --radius: 12px;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg-main);
  color: var(--text-primary);
  min-height: 100vh;
  line-height: 1.6;
  font-weight: 400;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ==================== HEADER ==================== */
header {
  background: var(--bg-main);
  border-bottom: 1px solid var(--border);
  padding: 16px 0;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(8px);
  background: rgba(255, 255, 255, 0.8);
}

.header-content {
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  display: flex;
  align-items: center;
  text-decoration: none;
  gap: 12px;
}

.logo-img {
  height: 48px;
  width: auto;
  display: block;
}

.logo-text {
  font-size: 20px;
  font-weight: 700;
  color: var(--primary);
  letter-spacing: -0.02em;
}

.back-btn {
  padding: 8px 16px;
  background: var(--primary);
  color: #fff;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.2s ease;
  border: none;
  cursor: pointer;
}

.back-btn:hover {
  background: #1f2937;
  transform: translateY(-1px);
}

/* ==================== CONTAINER ==================== */
.container {
  max-width: 1280px;
  margin: 0 auto;
  padding: 48px 24px 80px;
}

/* ==================== HERO SECTION ==================== */
.hero {
  text-align: center;
  margin-bottom: 64px;
}

.hero h1 {
  font-size: 48px;
  font-weight: 800;
  letter-spacing: -0.03em;
  margin-bottom: 16px;
  color: var(--primary);
}

.hero p {
  font-size: 18px;
  color: var(--text-secondary);
  font-weight: 400;
  max-width: 600px;
  margin: 0 auto;
}

/* ==================== STATS BAR ==================== */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 48px;
}

.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  text-align: center;
  transition: all 0.2s ease;
}

.stat-card:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-md);
}

.stat-label {
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-muted);
  font-weight: 600;
  margin-bottom: 8px;
}

.stat-value {
  font-size: 28px;
  font-weight: 700;
  color: var(--primary);
  letter-spacing: -0.02em;
}

.stat-subtext {
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 4px;
}

/* ==================== PROGRESS BAR ==================== */
.progress-wrapper {
  margin-top: 16px;
}

.progress-bar {
  height: 8px;
  background: #f3f4f6;
  border-radius: 999px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary) 0%, #374151 100%);
  width: 0%;
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 999px;
}

.progress-text {
  font-size: 12px;
  color: var(--text-muted);
  text-align: center;
  font-weight: 500;
}

/* ==================== MINT SECTIONS ==================== */
.mint-section {
  margin-bottom: 80px;
}

.section-header {
  margin-bottom: 32px;
  text-align: center;
}

.section-badge {
  display: inline-block;
  padding: 6px 12px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-secondary);
  margin-bottom: 12px;
}

.section-badge.paid {
  background: #000;
  color: #fff;
  border-color: #000;
}

.section-badge.free {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

.section-title {
  font-size: 36px;
  font-weight: 800;
  letter-spacing: -0.02em;
  color: var(--primary);
  margin-bottom: 8px;
}

.section-description {
  font-size: 16px;
  color: var(--text-secondary);
  max-width: 600px;
  margin: 0 auto;
}

/* ==================== MINT GRID ==================== */
.mint-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 32px;
  align-items: start;
}

@media (max-width: 1024px) {
  .mint-grid {
    grid-template-columns: 1fr;
  }
}

/* ==================== NFT PREVIEW ==================== */
.nft-preview {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  position: sticky;
  top: 100px;
}

.nft-grid-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

.nft-grid-container img {
  width: 100%;
  aspect-ratio: 1/1;
  object-fit: cover;
  border-radius: 8px;
  border: 1px solid var(--border);
  transition: all 0.2s ease;
}

.nft-grid-container img:hover {
  transform: scale(1.05);
  box-shadow: var(--shadow-md);
  border-color: var(--primary);
}

/* ==================== MINT CARD ==================== */
.mint-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px;
}

.price-display {
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 24px;
  text-align: center;
}

.price-label {
  font-size: 13px;
  color: var(--text-muted);
  font-weight: 500;
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.price-value {
  font-size: 48px;
  font-weight: 800;
  color: var(--primary);
  letter-spacing: -0.03em;
}

.price-value.free {
  color: var(--accent);
}

.price-subtext {
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 4px;
}

/* ==================== MINT BUTTON ==================== */
.mint-button {
  width: 100%;
  padding: 16px 24px;
  background: var(--primary);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: 'Inter', sans-serif;
  letter-spacing: -0.01em;
}

.mint-button:hover:not(:disabled) {
  background: #1f2937;
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.mint-button:active:not(:disabled) {
  transform: translateY(0);
}

.mint-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.mint-button.free {
  background: var(--accent);
}

.mint-button.free:hover:not(:disabled) {
  background: #7c3aed;
}

/* ==================== DEBUG INFO ==================== */
.debug-info {
  margin-top: 24px;
  padding: 16px;
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 12px;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
  max-height: 300px;
  overflow-y: auto;
}

.debug-log {
  margin: 4px 0;
  padding: 8px 12px;
  border-left: 3px solid #d1d5db;
  background: var(--bg-card);
  border-radius: 4px;
  line-height: 1.5;
}

.debug-error {
  border-left-color: #ef4444;
  background: #fef2f2;
  color: #dc2626;
}

.debug-success {
  border-left-color: #10b981;
  background: #f0fdf4;
  color: #059669;
}

/* ==================== DIVIDER ==================== */
.section-divider {
  margin: 80px 0;
  text-align: center;
  position: relative;
}

.section-divider::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 1px;
  background: var(--border);
}

.section-divider span {
  background: var(--bg-main);
  padding: 0 24px;
  position: relative;
  font-weight: 600;
  color: var(--text-secondary);
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
  .hero h1 {
    font-size: 32px;
  }

  .hero p {
    font-size: 16px;
  }

  .section-title {
    font-size: 28px;
  }

  .stats-bar {
    grid-template-columns: 1fr 1fr;
  }

  .nft-grid-container {
    grid-template-columns: repeat(2, 1fr);
  }

  .container {
    padding: 32px 16px 60px;
  }

  .mint-card {
    padding: 24px;
  }

  .price-value {
    font-size: 36px;
  }
}

/* ==================== ANIMATIONS ==================== */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.mint-section {
  animation: fadeIn 0.5s ease-out;
}
</style>
</head>

<body>

<!-- ==================== HEADER ==================== -->
<header>
  <div class="header-content">
    <a href="/" class="logo">
      <img src="https://kephost.net/p/MjI3NDg0NQ.png" alt="CatKitSune" class="logo-img">
      <span class="logo-text">CatKitSune</span>
    </a>
    <a class="back-btn" href="/">‚Üê Back to Dashboard</a>
  </div>
</header>

<!-- ==================== MAIN CONTAINER ==================== -->
<div class="container">

  <!-- ==================== HERO ==================== -->
  <div class="hero">
    <h1>Mint Your NFT</h1>
    <p>Join the CatKitSune collection on Hyperliquid. Choose between paid premium NFTs or free community drops.</p>
  </div>

  <!-- ==================== STATS BAR ==================== -->
  <div class="stats-bar">
    <div class="stat-card">
      <div class="stat-label">Total Minted</div>
      <div class="stat-value" id="totalMinted">‚Äî</div>
      <div class="stat-subtext">out of 522 total</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Paid Collection</div>
      <div class="stat-value" id="paidMinted">‚Äî</div>
      <div class="stat-subtext">/ 300 available</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Free Collection</div>
      <div class="stat-value" id="freeMinted">‚Äî</div>
      <div class="stat-subtext">/ 222 available</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Network</div>
      <div class="stat-value" style="font-size: 20px;">Hyperliquid</div>
      <div class="stat-subtext">Chain ID: 999</div>
    </div>
  </div>

  <!-- ==================== PAID MINT SECTION ==================== -->
  <div class="mint-section">
    <div class="section-header">
      <div class="section-badge paid">Premium Collection</div>
      <h2 class="section-title">CatKitSune NFT</h2>
      <p class="section-description">Official paid collection with exclusive artwork and utility features</p>
    </div>

    <div class="mint-grid">
      <!-- NFT Preview -->
      <div class="nft-preview">
        <div class="nft-grid-container">
          <img src="/launch/1.png" alt="NFT 1">
          <img src="/launch/2.png" alt="NFT 2">
          <img src="/launch/3.png" alt="NFT 3">
          <img src="/launch/4.png" alt="NFT 4">
          <img src="/launch/5.png" alt="NFT 5">
          <img src="/launch/6.png" alt="NFT 6">
          <img src="/launch/7.png" alt="NFT 7">
          <img src="/launch/8.png" alt="NFT 8">
          <img src="/launch/9.png" alt="NFT 9">
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-wrapper">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-text" id="progressText">Loading supply...</div>
        </div>
      </div>

      <!-- Mint Card -->
      <div class="mint-card">
        <div class="price-display">
          <div class="price-label">Mint Price</div>
          <div class="price-value">0.1 HYPE</div>
          <div class="price-subtext">+ gas fees</div>
        </div>

        <button class="mint-button" id="mintButton">Connect Wallet</button>

        <div class="debug-info" id="debugInfo">
          <div class="debug-log">Ready to connect wallet...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== DIVIDER ==================== -->
  <div class="section-divider">
    <span>Free Collection</span>
  </div>

  <!-- ==================== FREE MINT SECTION ==================== -->
  <div class="mint-section">
    <div class="section-header">
      <div class="section-badge free">Community Drop</div>
      <h2 class="section-title">VeLoRa Collection</h2>
      <p class="section-description">Free mint for the community - no cost, just gas fees</p>
    </div>

    <div class="mint-grid">
      <!-- NFT Preview -->
      <div class="nft-preview">
        <div class="nft-grid-container">
          <img src="/launch-free/1.png" alt="Free NFT 1">
          <img src="/launch-free/2.png" alt="Free NFT 2">
          <img src="/launch-free/3.png" alt="Free NFT 3">
          <img src="/launch-free/4.png" alt="Free NFT 4">
          <img src="/launch-free/5.png" alt="Free NFT 5">
          <img src="/launch-free/7.png" alt="Free NFT 7">
          <img src="/launch-free/8.png" alt="Free NFT 8">
          <img src="/launch-free/9.png" alt="Free NFT 9">
          <img src="/launch-free/10.png" alt="Free NFT 10">
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-wrapper">
          <div class="progress-bar">
            <div class="progress-fill" id="freeProgressFill"></div>
          </div>
          <div class="progress-text" id="freeProgressText">Loading supply...</div>
        </div>
      </div>

      <!-- Mint Card -->
      <div class="mint-card">
        <div class="price-display">
          <div class="price-label">Mint Price</div>
          <div class="price-value free">FREE</div>
          <div class="price-subtext">only gas fees apply</div>
        </div>

        <button class="mint-button free" id="freeMintButton">Connect Wallet</button>

        <div class="debug-info" id="freeDebugInfo">
          <div class="debug-log">Ready to connect wallet...</div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
// ===========================
// HYPERLIQUID CONFIG
// ===========================
const HYPERLIQUID_CONFIG = {
  chainId: '0x3E7', // 999 decimal (MAINNET)
  chainName: 'Hyperliquid',
  rpcUrls: ['https://rpc.hyperliquid.xyz/evm'],
  nativeCurrency: {
    name: 'HYPE',
    symbol: 'HYPE',
    decimals: 18
  },
  blockExplorerUrls: ['https://hypurrscan.io']
};

// ===========================
// PAID MINT CONTRACT CONFIG
// ===========================
const CONTRACT_ADDRESS = '0x2abF2969E5e9cAAa1D3fF3DF4265dFFcda0D8353';
const CONTRACT_ABI = [
  'function mint() public payable',
  'function _tokenIdCounter() public view returns (uint256)',
  'function MAX_SUPPLY() public view returns (uint256)',
  'function balanceOf(address owner) public view returns (uint256)',
  'function owner() public view returns (address)',
  'function mintPrice() public view returns (uint256)'
];
const MINT_PRICE = ethers.utils.parseEther('0.1');
let currentMintedSupply = 27;
const MAX_SUPPLY = 300;

// ===========================
// FREE MINT CONTRACT CONFIG
// ===========================
const FREE_CONTRACT_ADDRESS = '0x568d76Cb80cAa08A2196467ed5cBdFBD4D74b1eE';
const FREE_CONTRACT_ABI = [
  'function mint() public payable',
  'function _tokenIdCounter() public view returns (uint256)',
  'function MAX_SUPPLY() public view returns (uint256)',
  'function balanceOf(address owner) public view returns (uint256)',
  'function maxPerWallet() public view returns (uint256)'
];
const FREE_MINT_PRICE = ethers.utils.parseEther('0');
let freeCurrentMintedSupply = 0;
const FREE_MAX_SUPPLY = 222;

// ===========================
// GLOBAL VARIABLES
// ===========================
let provider = null;
let signer = null;
let contract = null;
let freeContract = null;
let userAddress = null;

let isConnecting = false;
let isSwitchingNetwork = false;
let connectionAttempts = 0;
const MAX_CONNECTION_ATTEMPTS = 3;

// ===========================
// DEBUG LOGGING
// ===========================
function log(message, type = 'info', isFree = false) {
  const debugDiv = document.getElementById(isFree ? 'freeDebugInfo' : 'debugInfo');
  const logClass = type === 'error' ? 'debug-error' : type === 'success' ? 'debug-success' : 'debug-log';
  const timestamp = new Date().toLocaleTimeString();
  debugDiv.innerHTML += `<div class="${logClass}">[${timestamp}] ${message}</div>`;
  debugDiv.scrollTop = debugDiv.scrollHeight;
  console.log(`[${isFree ? 'FREE' : 'PAID'}] [${type.toUpperCase()}] ${message}`);
}

// ===========================
// UPDATE TOTAL STATS
// ===========================
function updateTotalStats() {
  const total = currentMintedSupply + freeCurrentMintedSupply;
  document.getElementById('totalMinted').textContent = total;
  document.getElementById('paidMinted').textContent = currentMintedSupply;
  document.getElementById('freeMinted').textContent = freeCurrentMintedSupply;
}

// ===========================
// WALLET CONNECTION (PAID)
// ===========================
async function connectWallet() {
  if (CONTRACT_ADDRESS === '0xYourContractAddressHere' || !CONTRACT_ADDRESS.startsWith('0x') || CONTRACT_ADDRESS.length !== 42) {
    log('‚ùå CONTRACT ADDRESS NOT CONFIGURED!', 'error');
    alert('Error: Contract address is not set!');
    return;
  }

  if (isConnecting) {
    log('Connection already in progress, please wait...', 'error');
    return;
  }

  if (connectionAttempts >= MAX_CONNECTION_ATTEMPTS) {
    log('Too many connection attempts. Please refresh the page.', 'error');
    alert('Too many connection attempts. Please refresh the page and try again.');
    return;
  }

  isConnecting = true;
  connectionAttempts++;

  try {
    log('Checking for MetaMask...');
    
    if (typeof window.ethereum === 'undefined') {
      throw new Error('MetaMask not installed! Please install MetaMask extension.');
    }

    log('MetaMask detected, requesting accounts...');
    
    const accounts = await window.ethereum.request({ 
      method: 'eth_requestAccounts' 
    });
    
    userAddress = accounts[0];
    log(`Connected: ${userAddress.substring(0, 6)}...${userAddress.substring(38)}`, 'success');

    const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });
    log(`Current network: ${currentChainId}`);
    
    if (currentChainId.toLowerCase() !== HYPERLIQUID_CONFIG.chainId.toLowerCase()) {
      log(`Wrong network! Switching to Hyperliquid...`, 'error');
      await switchToHyperliquid();
      
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      const newChainId = await window.ethereum.request({ method: 'eth_chainId' });
      if (newChainId.toLowerCase() !== HYPERLIQUID_CONFIG.chainId.toLowerCase()) {
        throw new Error(`Network switch failed. Please manually switch to Hyperliquid mainnet (Chain ID: 999) in MetaMask.`);
      }
    }

    provider = new ethers.providers.Web3Provider(window.ethereum, {
      name: 'hyperliquid',
      chainId: parseInt(HYPERLIQUID_CONFIG.chainId, 16),
      ensAddress: null
    });
    signer = provider.getSigner();

    log(`Initializing contract...`);
    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
    log('Contract initialized ‚úì', 'success');

    updateButtonState('connected');
    await loadSupplyData();

    connectionAttempts = 0;

  } catch (error) {
    log(`Connection error: ${error.message}`, 'error');
    
    if (error.code === 4001) {
      alert('Connection cancelled by user');
    } else {
      alert(`Connection failed: ${error.message}`);
    }
  } finally {
    isConnecting = false;
  }
}

// ===========================
// WALLET CONNECTION (FREE)
// ===========================
async function connectWalletFree() {
  if (FREE_CONTRACT_ADDRESS === '0xYourFreeContractAddressHere' || !FREE_CONTRACT_ADDRESS.startsWith('0x') || FREE_CONTRACT_ADDRESS.length !== 42) {
    log('‚ùå FREE CONTRACT ADDRESS NOT CONFIGURED!', 'error', true);
    alert('Error: Free mint contract address is not set!');
    return;
  }

  if (isConnecting) {
    log('Connection already in progress, please wait...', 'error', true);
    return;
  }

  isConnecting = true;
  connectionAttempts++;

  try {
    log('Checking for MetaMask...', 'info', true);
    
    if (typeof window.ethereum === 'undefined') {
      throw new Error('MetaMask not installed! Please install MetaMask extension.');
    }

    log('MetaMask detected, requesting accounts...', 'info', true);
    
    const accounts = await window.ethereum.request({ 
      method: 'eth_requestAccounts' 
    });
    
    userAddress = accounts[0];
    log(`Connected: ${userAddress.substring(0, 6)}...${userAddress.substring(38)}`, 'success', true);

    const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });
    
    if (currentChainId.toLowerCase() !== HYPERLIQUID_CONFIG.chainId.toLowerCase()) {
      log(`Wrong network! Switching to Hyperliquid...`, 'error', true);
      await switchToHyperliquid();
      
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      const newChainId = await window.ethereum.request({ method: 'eth_chainId' });
      if (newChainId.toLowerCase() !== HYPERLIQUID_CONFIG.chainId.toLowerCase()) {
        throw new Error(`Network switch failed. Please manually switch to Hyperliquid mainnet.`);
      }
    }

    provider = new ethers.providers.Web3Provider(window.ethereum, {
      name: 'hyperliquid',
      chainId: parseInt(HYPERLIQUID_CONFIG.chainId, 16),
      ensAddress: null
    });
    signer = provider.getSigner();

    log(`Initializing free contract...`, 'info', true);
    freeContract = new ethers.Contract(FREE_CONTRACT_ADDRESS, FREE_CONTRACT_ABI, signer);
    log('Free contract initialized ‚úì', 'success', true);

    updateButtonState('connected', true);
    await loadSupplyData(true);

    connectionAttempts = 0;

  } catch (error) {
    log(`Connection error: ${error.message}`, 'error', true);
    
    if (error.code === 4001) {
      alert('Connection cancelled by user');
    } else {
      alert(`Connection failed: ${error.message}`);
    }
  } finally {
    isConnecting = false;
  }
}

// ===========================
// NETWORK SWITCHING
// ===========================
async function switchToHyperliquid() {
  if (isSwitchingNetwork) {
    throw new Error('Network switch already in progress.');
  }

  isSwitchingNetwork = true;

  try {
    await window.ethereum.request({
      method: 'wallet_switchEthereumChain',
      params: [{ chainId: HYPERLIQUID_CONFIG.chainId }],
    });
    log('Switched to Hyperliquid ‚úì', 'success');
    
  } catch (switchError) {
    if (switchError.code === 4902) {
      log('Adding Hyperliquid network...');
      
      try {
        await window.ethereum.request({
          method: 'wallet_addEthereumChain',
          params: [{
            chainId: HYPERLIQUID_CONFIG.chainId,
            chainName: HYPERLIQUID_CONFIG.chainName,
            rpcUrls: HYPERLIQUID_CONFIG.rpcUrls,
            nativeCurrency: HYPERLIQUID_CONFIG.nativeCurrency,
            blockExplorerUrls: HYPERLIQUID_CONFIG.blockExplorerUrls
          }]
        });
        log('Hyperliquid network added ‚úì', 'success');
      } catch (addError) {
        throw new Error(`Failed to add Hyperliquid network: ${addError.message}`);
      }
    } else {
      throw switchError;
    }
  } finally {
    isSwitchingNetwork = false;
  }
}

// ===========================
// SUPPLY DATA
// ===========================
async function loadSupplyData(isFree = false) {
  const minted = isFree ? freeCurrentMintedSupply : currentMintedSupply;
  const max = isFree ? FREE_MAX_SUPPLY : MAX_SUPPLY;
  const percentage = (minted / max) * 100;
  
  const fillId = isFree ? 'freeProgressFill' : 'progressFill';
  const textId = isFree ? 'freeProgressText' : 'progressText';
  
  document.getElementById(fillId).style.width = `${percentage}%`;
  document.getElementById(textId).textContent = `${minted} / ${max} minted (${percentage.toFixed(1)}%)`;
  
  updateTotalStats();
  
  log(`Supply: ${minted}/${max} (${percentage.toFixed(1)}%)`, 'success', isFree);
  
  try {
    let readContract = isFree ? freeContract : contract;
    
    if (!readContract) {
      const readProvider = new ethers.providers.JsonRpcProvider(HYPERLIQUID_CONFIG.rpcUrls[0]);
      const addr = isFree ? FREE_CONTRACT_ADDRESS : CONTRACT_ADDRESS;
      const abi = isFree ? FREE_CONTRACT_ABI : CONTRACT_ABI;
      readContract = new ethers.Contract(addr, abi, readProvider);
    }
    
    try {
      const counter = await readContract._tokenIdCounter();
      const contractCount = counter.toNumber();
      if (contractCount > 0) {
        if (isFree) {
          freeCurrentMintedSupply = contractCount;
        } else {
          currentMintedSupply = contractCount;
        }
        log(`Contract counter: ${contractCount} ‚úì`, 'success', isFree);
        const newPercentage = (contractCount / max) * 100;
        document.getElementById(fillId).style.width = `${newPercentage}%`;
        document.getElementById(textId).textContent = `${contractCount} / ${max} minted (${newPercentage.toFixed(1)}%)`;
        updateTotalStats();
      }
    } catch (e) {
      // Silently ignore
    }
    
  } catch (error) {
    // Silently ignore
  }
}

// ===========================
// MINTING (PAID)
// ===========================
async function mintNFT() {
  if (!contract || !signer) {
    log('Wallet not connected!', 'error');
    return;
  }

  try {
    log('Starting mint transaction...', 'success');
    updateButtonState('minting');

    const tx = await contract.mint({ value: MINT_PRICE });

    log(`Transaction sent: ${tx.hash}`, 'success');
    log('‚è≥ Waiting for confirmation...', 'success');

    const receipt = await tx.wait();
    
    log(`‚úÖ MINTED SUCCESSFULLY! Block: ${receipt.blockNumber}`, 'success');

    currentMintedSupply++;
    await loadSupplyData();
    
    updateButtonState('connected');
    
    alert(`üéâ NFT Successfully Minted!\n\nTransaction: ${tx.hash.substring(0, 10)}...`);

  } catch (error) {
    log(`‚ùå Mint failed: ${error.message}`, 'error');
    
    if (error.code === 4001 || error.code === 'ACTION_REJECTED') {
      alert('Transaction cancelled by user');
    } else {
      alert(`Minting failed: ${error.message}`);
    }
    
    updateButtonState('connected');
  }
}

// ===========================
// MINTING (FREE)
// ===========================
async function mintNFTFree() {
  if (!freeContract || !signer) {
    log('Wallet not connected!', 'error', true);
    return;
  }

  try {
    log('Starting free mint...', 'success', true);
    updateButtonState('minting', true);

    const tx = await freeContract.mint({ value: FREE_MINT_PRICE });

    log(`Transaction sent: ${tx.hash}`, 'success', true);
    log('‚è≥ Waiting for confirmation...', 'success', true);

    const receipt = await tx.wait();
    
    log(`‚úÖ FREE MINT SUCCESS! Block: ${receipt.blockNumber}`, 'success', true);

    freeCurrentMintedSupply++;
    await loadSupplyData(true);
    
    updateButtonState('connected', true);
    
    alert(`üéâ Free NFT Successfully Minted!\n\nTransaction: ${tx.hash.substring(0, 10)}...`);

  } catch (error) {
    log(`‚ùå Free mint failed: ${error.message}`, 'error', true);
    
    if (error.code === 4001 || error.code === 'ACTION_REJECTED') {
      alert('Transaction cancelled by user');
    } else {
      alert(`Free minting failed: ${error.message}`);
    }
    
    updateButtonState('connected', true);
  }
}

// ===========================
// BUTTON STATE MANAGEMENT
// ===========================
function updateButtonState(state, isFree = false) {
  const button = document.getElementById(isFree ? 'freeMintButton' : 'mintButton');
  
  switch(state) {
    case 'connected':
      button.textContent = isFree ? 'Mint Free NFT' : 'Mint NFT (0.1 HYPE)';
      button.disabled = false;
      button.onclick = isFree ? mintNFTFree : mintNFT;
      break;
    case 'minting':
      button.textContent = 'Minting...';
      button.disabled = true;
      break;
    default:
      button.textContent = 'Connect Wallet';
      button.disabled = false;
      button.onclick = isFree ? connectWalletFree : connectWallet;
  }
}

// ===========================
// EVENT LISTENERS
// ===========================
document.getElementById('mintButton').addEventListener('click', connectWallet);
document.getElementById('freeMintButton').addEventListener('click', connectWalletFree);

if (window.ethereum) {
  window.ethereum.on('chainChanged', () => {
    window.location.reload();
  });

  window.ethereum.on('accountsChanged', (accounts) => {
    if (accounts.length === 0) {
      updateButtonState('disconnected');
      updateButtonState('disconnected', true);
    } else {
      window.location.reload();
    }
  });
}

// ===========================
// INITIAL LOAD
// ===========================
window.addEventListener('load', () => {
  log('Page loaded, ready to connect');
  log('Page loaded, ready to connect', 'info', true);
  
  loadSupplyData();
  loadSupplyData(true);
  
  setInterval(async () => {
    await loadSupplyData();
    await loadSupplyData(true);
  }, 5000);
});
</script>

</body>
</html>
