<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CatKitSune ‚Äì Free Mint</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
body{font-family:Arial;background:#0f172a;color:#fff;text-align:center;padding-top:100px}
button{padding:20px 40px;font-size:20px;border-radius:12px;border:none;cursor:pointer;background:#14b8a6;color:#000;font-weight:700}
#status{margin-top:20px;padding:10px;background:#1e293b;border-radius:8px;max-width:600px;margin-left:auto;margin-right:auto}
</style>
</head>
<body>
<h1>üê± CatKitSune</h1>
<h2>Mint 1 NFT ‚Äì FREE</h2>
<p>0 HYPE ¬∑ Test mint</p>
<button onclick="mint()">Connect & Mint</button>
<div id="status"></div>
<script>
const CONTRACT_ADDRESS = "0xf64D89F2DD7E26C4b4555F03b556428F1EBe9598";
const HYPEREVM_CHAIN_ID = "0x3e7"; // 999
const ABI = [
  "function publicMint(uint256 quantity) payable",
  "function totalSupply() view returns (uint256)",
  "function maxSupply() view returns (uint256)"
];

function log(msg) {
  document.getElementById('status').innerHTML = msg;
  console.log(msg);
}

async function ensureHyperEVM() {
  const currentChain = await window.ethereum.request({ method: "eth_chainId" });
  if (currentChain !== HYPEREVM_CHAIN_ID) {
    log("üîÑ Switching to HyperEVM...");
    await window.ethereum.request({
      method: "wallet_switchEthereumChain",
      params: [{ chainId: HYPEREVM_CHAIN_ID }]
    });
    await new Promise(resolve => setTimeout(resolve, 1000));
  }
}

async function mint() {
  try {
    if (!window.ethereum) {
      alert("MetaMask required");
      return;
    }
    
    log("üîå Connecting wallet...");
    await window.ethereum.request({ method: "eth_requestAccounts" });
    await ensureHyperEVM();
    
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    const signer = provider.getSigner();
    
    // ‚úÖ Ellen≈ërizz√ºk, hogy l√©tezik-e a contract
    log("üîç Checking contract...");
    const code = await provider.getCode(CONTRACT_ADDRESS);
    if (code === '0x') {
      throw new Error("Contract not deployed at this address!");
    }
    
    const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
    
    // ‚úÖ Ellen≈ërizz√ºk a supply-t
    try {
      const totalSupply = await contract.totalSupply();
      const maxSupply = await contract.maxSupply();
      log(`üìä Supply: ${totalSupply}/${maxSupply}`);
      
      if (totalSupply.gte(maxSupply)) {
        throw new Error("Max supply reached!");
      }
    } catch (e) {
      log("‚ö†Ô∏è Could not check supply (functions may not exist)");
    }
    
    // ‚úÖ Pr√≥b√°ljuk meg a mintet
    log("‚õèÔ∏è Minting...");
    const tx = await contract.publicMint(1, { 
      value: 0,
      gasLimit: 500000 // Explicit gas limit
    });
    
    log("‚è≥ Waiting for confirmation...");
    await tx.wait();
    
    log("‚úÖ FREE NFT MINTED SUCCESSFULLY!");
  } catch (err) {
    console.error(err);
    let errorMsg = "‚ùå Mint failed: ";
    
    if (err.code === 'UNPREDICTABLE_GAS_LIMIT') {
      errorMsg += "Transaction would fail. Possible reasons:\n";
      errorMsg += "- Contract not deployed\n";
      errorMsg += "- Minting not started yet\n";
      errorMsg += "- Max supply reached\n";
      errorMsg += "- Wrong network";
    } else if (err.message) {
      errorMsg += err.message;
    } else {
      errorMsg += "Unknown error (check console)";
    }
    
    log(errorMsg);
  }
}
</script>
</body>
</html>
