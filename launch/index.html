<script>
/* =====================================================
   CONFIG â€“ NEM NYÃšLUNK A KINÃ‰ZETHEZ
===================================================== */
const MODE = "LIVE"; // LIVE !!!
const CONTRACT_ADDRESS = "0xe428ADb731D5fd4E5a117C85059828d894683E78";
const PRICE_PER_NFT = 0.5;
const HYPERLIQUID_CHAIN_ID = "0x3e7"; // HyperEVM MAINNET

const ABI = [
  "function publicMint(uint256 quantity) payable",
  "function totalSupply() view returns (uint256)"
];

let provider, signer, contract;
let quantity = 1;
let isConnected = false;
let userAddress = "";

/* =====================================================
   WALLET + NETWORK
===================================================== */
async function connectWallet() {
  if (!window.ethereum) {
    showStatus("MetaMask szÃ¼ksÃ©ges!", "error");
    return;
  }

  await window.ethereum.request({
    method: "wallet_switchEthereumChain",
    params: [{ chainId: HYPERLIQUID_CHAIN_ID }]
  });

  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  userAddress = await signer.getAddress();

  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

  isConnected = true;
  document.getElementById("walletAddress").innerText =
    userAddress.slice(0, 6) + "..." + userAddress.slice(-4);
  document.getElementById("walletInfo").style.display = "block";
  document.getElementById("mintButton").innerText =
    "ðŸš€ Mint " + quantity + " NFT";

  showStatus("Wallet csatlakoztatva", "success");
}

/* =====================================================
   QUANTITY
===================================================== */
function increaseQuantity() {
  quantity++;
  updateQuantityDisplay();
}
function decreaseQuantity() {
  if (quantity > 1) quantity--;
  updateQuantityDisplay();
}
function updateQuantityDisplay() {
  document.getElementById("quantityDisplay").innerText = quantity;
  document.getElementById("totalPrice").innerText =
    (quantity * PRICE_PER_NFT).toFixed(1) + " HYPE";
}

/* =====================================================
   STATUS
===================================================== */
function showStatus(msg, type) {
  const el = document.getElementById("statusMessage");
  el.className = "status-message " + type;
  el.innerText = msg;
}

/* =====================================================
   MINT â€“ EZ MOST MÃR IGAZI
===================================================== */
async function handleMint() {
  if (!isConnected) {
    await connectWallet();
    return;
  }

  try {
    showStatus("MintelÃ©s folyamatban...", "info");
    document.getElementById("mintButton").disabled = true;

    const value = ethers.utils.parseEther(
      (PRICE_PER_NFT * quantity).toString()
    );

    const tx = await contract.publicMint(quantity, { value });
    await tx.wait();

    showStatus("âœ… Sikeres mint!", "success");
    document.getElementById("mintButton").innerText = "ðŸŽ‰ Mint More";
  } catch (err) {
    console.error(err);
    showStatus("âŒ Mint hiba", "error");
  } finally {
    document.getElementById("mintButton").disabled = false;
  }
}

/* =====================================================
   INIT
===================================================== */
window.addEventListener("DOMContentLoaded", () => {
  updateQuantityDisplay();
});
</script>
