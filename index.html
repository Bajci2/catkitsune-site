<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>CatKitSune ‚Äì Quests & Swap</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg-main: #f6ecff;
      --bg-card: #ffffff;
      --primary: #6a3df5;
      --primary-soft: #e2d6ff;
      --accent-green: #28c76f;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --shadow-card: 0 10px 30px rgba(15, 23, 42, 0.12);
    }

    body {
      font-family: "Inter", sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
      min-height: 100vh;
    }

    .app { min-height: 100vh; display: flex; flex-direction: column; }

    header {
      padding: 10px 16px;
      background: var(--bg-main);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
    }

    .logo {
      font-size: 14px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .paw-icon {
      width: 24px;
      height: 24px;
      display: inline-block;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><ellipse cx="65" cy="50" rx="23" ry="33" fill="%238b5cf6"/><ellipse cx="135" cy="50" rx="23" ry="33" fill="%238b5cf6"/><ellipse cx="35" cy="80" rx="20" ry="30" fill="%238b5cf6" transform="rotate(-25 35 80)"/><ellipse cx="165" cy="80" rx="20" ry="30" fill="%238b5cf6" transform="rotate(25 165 80)"/><ellipse cx="100" cy="130" rx="55" ry="50" fill="%238b5cf6"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    .top-actions { display: flex; align-items: center; gap: 8px; }

    .login-btn {
      font-size: 12px; padding: 6px 12px; border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      cursor: pointer;
      display:flex;
      align-items:center;
      gap:6px;
      transition: all 0.2s;
    }

    .login-btn:hover {
      background: #f3f4f6;
      transform: translateY(-1px);
    }

    .avatar {
      width: 26px; height: 26px; border-radius: 50%;
      background: linear-gradient(135deg, #6a3df5, #22c55e);
    }

    main { flex: 1; padding: 24px 12px 80px; max-width: 1200px; margin: 0 auto; width: 100%; }

    .top-nav {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .top-nav-btn {
      padding: 8px 18px;
      font-size: 13px;
      border-radius: 999px;
      border: 1px solid #d4d4d8;
      background: #fff;
      cursor: pointer;
      transition: 0.2s;
    }

    .top-nav-btn:hover { background: #f3f4f6; }

    .top-nav-btn.active {
      background: #6a3df5;
      color: white;
      border-color: #6a3df5;
    }

    .view { display: none; }
    .view.active { display: block; }

    .hero-card {
      background: linear-gradient(180deg, #f6ecff 0%, #efe3ff 100%);
      border-radius: 24px;
      padding: 32px 20px 20px;
      box-shadow: var(--shadow-card);
      margin-bottom: 20px;
      text-align: center;
    }

    .hero-title { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
    .hero-sub { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; }

    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px; margin-bottom: 18px;
    }

    .stat-card {
      background: #fff;
      border-radius: 18px;
      padding: 10px 8px;
      border: 1px solid var(--primary-soft);
    }

    .stat-label { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; }
    .stat-value { font-size: 18px; font-weight: 700; }

    .content-grid {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .quests-section {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-card);
      padding: 18px 16px;
    }

    .card-title {
      font-size: 14px; font-weight: 700; margin-bottom: 12px;
      display: flex; align-items: center; gap: 8px;
    }

    .card-title span.dot {
      width: 6px; height: 6px; border-radius: 999px; background: var(--primary);
    }

    .mission-list { display: flex; flex-direction: column; gap: 8px; }

    .mission-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 9px 10px; border-radius: 12px;
      border: 1px solid #e5e7eb; background: #f9fafb;
      font-size: 12px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .mission-item:hover {
      border-color: var(--primary);
      background: #f2ecff;
    }

    .mission-left { display: flex; align-items: center; gap: 10px; }

    .mission-check {
      width: 16px; height: 16px; border-radius: 999px;
      border: 2px solid #d1d5db; background: #fff;
    }

    .mission-check.completed {
      background: var(--accent-green);
      border-color: var(--accent-green);
    }

    .mission-text-title { font-weight: 600; margin-bottom: 2px; }
    .mission-text-sub { color: var(--text-muted); font-size: 11px; }

    .mission-points { color: #16a34a; font-weight: 600; font-size: 12px; }

    .leader-list { display: flex; flex-direction: column; gap: 8px; margin-top: 6px; }

    .leader-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 6px 9px; border-radius: 10px;
      border: 1px solid #e5e7eb; font-size: 11px;
    }

    .leader-item.active {
      border-color: var(--primary);
      background: #f2ecff;
    }

    .leader-left { display: flex; align-items: center; gap: 6px; }

    .leader-rank {
      width: 18px; height: 18px; border-radius: 999px;
      background: #f3f4f6; display: flex; align-items: center;
      justify-content: center; font-size: 10px; font-weight: 600;
    }

    .leader-points { font-weight: 600; font-size: 11px; }

    .nft-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .nft-card {
      border-radius: 12px; border: 1px dashed #d4d4d8;
      background: #f9fafb; padding: 12px 6px; text-align: center;
      font-size: 10px; color: var(--text-muted);
    }

    .nft-card strong {
      display: block; font-size: 11px; margin-bottom: 2px;
      color: var(--text-main);
    }

    .swap-card {
      max-width: 420px; width: 100%;
      background: #fff; border-radius: 22px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-card);
      padding: 20px;
      margin: 0 auto;
    }

    .swap-header h2 {
      text-align: center;
      font-size: 20px; font-weight: 700;
      margin-bottom: 20px;
    }

    .swap-field {
      background: #f9fafb; border-radius: 14px;
      border: 1px solid #e5e7eb; padding: 12px;
      margin-bottom: 12px; font-size: 12px;
    }

    .swap-row {
      display: flex; align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .swap-label-small {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .swap-amount-input {
      text-align: right;
      border: none;
      background: none;
      font-size: 16px;
      font-weight: 700;
      width: 110px;
      outline: none;
    }

    .swap-center-icon {
      width: 34px; height: 34px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #fff;
      display: flex; align-items: center;
      justify-content: center;
      font-size: 14px;
      margin: 10px auto;
      cursor: pointer;
      transition: all 0.2s;
    }

    .swap-center-icon:hover {
      transform: rotate(180deg);
      background: #f3f4f6;
    }

    .swap-btn {
      width: 100%;
      padding: 12px 0;
      border-radius: 999px;
      background: #6a3df5;
      color: white;
      border: none;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .swap-btn:hover {
      background: #5a2dd5;
      transform: translateY(-2px);
    }

    .swap-btn:disabled {
      background: #d1d5db;
      cursor: not-allowed;
      transform: none;
    }

    .token-select {
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid #d4d4ff;
      background: #ffffff;
      font-size: 13px;
      min-width: 120px;
      cursor: pointer;
    }

    /* LEADERBOARD STYLES */
    .leaderboard-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .leaderboard-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .leaderboard-header h1 {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .leaderboard-header p {
      font-size: 14px;
      color: var(--text-muted);
    }

    .leaderboard-search {
      position: relative;
      margin-bottom: 20px;
    }

    .leaderboard-search input {
      width: 100%;
      padding: 12px 40px 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 14px;
      outline: none;
      background: white;
    }

    .leaderboard-search input:focus {
      border-color: var(--primary);
    }

    .leaderboard-search::before {
      content: "üîç";
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
    }

    .leaderboard-table {
      background: white;
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-card);
      overflow: hidden;
    }

    .leaderboard-table-header {
      display: grid;
      grid-template-columns: 80px 1fr 2fr 1fr;
      padding: 14px 20px;
      background: #f9fafb;
      border-bottom: 1px solid var(--border);
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
    }

    .leaderboard-row {
      display: grid;
      grid-template-columns: 80px 1fr 2fr 1fr;
      padding: 14px 20px;
      border-bottom: 1px solid #f3f4f6;
      font-size: 13px;
      transition: all 0.2s;
      align-items: center;
    }

    .leaderboard-row:last-child {
      border-bottom: none;
    }

    .leaderboard-row:hover {
      background: #f9fafb;
    }

    .leaderboard-row.highlight {
      background: #f2ecff;
      border-left: 3px solid var(--primary);
    }

    .rank-cell {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
    }

    .rank-medal {
      font-size: 18px;
    }

    .user-cell {
      font-weight: 600;
      color: var(--text-main);
    }

    .address-cell {
      font-family: 'Courier New', monospace;
      color: var(--text-muted);
      font-size: 12px;
    }

    .points-cell {
      font-weight: 700;
      color: var(--primary);
      text-align: right;
    }

    .leaderboard-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 30px;
    }

    .stat-box {
      background: white;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 20px;
      text-align: center;
      box-shadow: var(--shadow-card);
    }

    .stat-box-value {
      font-size: 28px;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 4px;
    }

    .stat-box-label {
      font-size: 13px;
      color: var(--text-muted);
    }

    @media (max-width: 768px) {
      .leaderboard-table-header,
      .leaderboard-row {
        grid-template-columns: 60px 1fr 1fr;
      }
      .address-cell {
        display: none;
      }
      .leaderboard-stats {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
<div class="app">
<!-- HEADER -->
<header>
<div class="logo" onclick="showView(event, 'quests')">
<span class="paw-icon"></span>
<span>CatKitSune</span>
</div>
<div class="top-actions">
<!-- WALLET BUTTON -->
<button class="login-btn" id="walletBtn" onclick="toggleWallet()">
<img src="https://cdn-icons-png.flaticon.com/512/891/891462.png" style="width:18px;"/>
        <span id="walletText">Connect Wallet</span>
      </button>
<!-- TWITTER LOGIN -->
<button class="login-btn" id="twitterBtn" onclick="loginWithTwitter()">
<img src="https://cdn-icons-png.flaticon.com/512/733/733579.png" style="width:18px;"/>
        Login with Twitter
      </button>
<div id="twitterAvatar" style="display:none; align-items:center; gap:6px;"></div>
<div class="avatar"></div>
</div>
</header>
<!-- TOP NAVIGATION -->
<div class="top-nav">
<button class="top-nav-btn active" onclick="showView(event, 'quests')">Quests</button>
<button class="top-nav-btn" onclick="showView(event, 'swap')">Swap</button>
<button class="top-nav-btn" onclick="showView(event, 'airdrop')">Airdrop</button>
<button class="top-nav-btn" onclick="showView(event, 'cks')">CKS Token</button>
</div>
<!-- QUESTS VIEW -->
<main class="view active" id="view-quests">
<div class="hero-card">
<div class="hero-title">Complete quests. Earn points. Climb the leaderboard.</div>
<div class="hero-sub">Join the community and reach the highest level!</div>
<div class="stats-row">
<div class="stat-card"><div class="stat-label">Total Points</div><div class="stat-value" id="totalPoints">0</div></div>
<div class="stat-card"><div class="stat-label">Quests</div><div class="stat-value">11</div></div>
<div class="stat-card"><div class="stat-label">Completed</div><div class="stat-value" id="completedQuests">0</div></div>
<div class="stat-card"><div class="stat-label">Rank</div><div class="stat-value">#4</div></div>
</div>
</div>
<div class="content-grid">
<!-- QUESTS SECTION (2 oszlop) -->
<div class="quests-section">
<!-- LEFT COLUMN ‚Äì QUESTS -->
<div class="card">
<div class="card-title"><span class="dot"></span> Quests</div>
<div class="mission-list">
<div class="mission-item" onclick="completeQuest(this, 150)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Follow on X</div>
<div class="mission-text-sub">Follow <a href="https://x.com/GborSzakl1" target="_blank" onclick="event.stopPropagation()">@GborSzakl1</a> on X.</div>
</div>
</div>
<div class="mission-points">+150 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 300)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Mint the CatKitSune NFT</div>
<div class="mission-text-sub">Airdrop bonus reward.</div>
</div>
</div>
<div class="mission-points">+300 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 150)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Swap on CatKitSune</div>
<div class="mission-text-sub">Make a swap worth at least $10.</div>
</div>
</div>
<div class="mission-points">+150 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 250)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Share on X</div>
<div class="mission-text-sub"><a href="https://x.com/GborSzakl1/status/1989254176568672659" target="_blank" onclick="event.stopPropagation()">Open Tweet</a></div>
</div>
</div>
<div class="mission-points">+250 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 500)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Bridge to HYPE</div>
<div class="mission-text-sub">Bridge $10 to HYPE.</div>
</div>
</div>
<div class="mission-points">+500 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 300)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Mini Mover</div>
<div class="mission-text-sub">Transact $50 today.</div>
</div>
</div>
<div class="mission-points">+300 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 200)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Referral Runner</div>
<div class="mission-text-sub">Refer 1 new user.</div>
</div>
</div>
<div class="mission-points">+200 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 300)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Earn Boost</div>
<div class="mission-text-sub">Complete 3 tasks.</div>
</div>
</div>
<div class="mission-points">+300 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 800)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Weekly Volume</div>
<div class="mission-text-sub">Transact $2000.</div>
</div>
</div>
<div class="mission-points">+800 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 200)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Swap It Up</div>
<div class="mission-text-sub">Swap $10 on KittenSwap.</div>
</div>
</div>
<div class="mission-points">+200 EP</div>
</div>

<div class="mission-item" onclick="completeQuest(this, 1200)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Hold all NFTs</div>
<div class="mission-text-sub">Own 1 from each listed collection.</div>
</div>
</div>
<div class="mission-points">+1200 EP</div>
</div>
</div>
</div>
<!-- RIGHT COLUMN - NFT GALLERY ONLY -->
<div class="card">
<div class="card-title"><span class="dot"></span> NFT Gallery</div>
<div class="nft-grid">
<div class="nft-card"><strong></strong>CatKitSune</div>
<div class="nft-card"><strong></strong>CatKitSune</div>
<div class="nft-card"><strong></strong>Hyperian Genesis</div>
<div class="nft-card"><strong></strong>Wealthy Hypio Babies</div>
<div class="nft-card"><strong></strong>Tiny Hyper Cats</div>
<div class="nft-card"><strong></strong>Illumeownati by Catbal</div>
<div class="nft-card"><strong></strong>PiP & Friends</div>
<div class="nft-card"><strong></strong>Hypers</div>
<div class="nft-card"><strong></strong>Mechacats</div>
<div class="nft-card"><strong></strong>LQnians</div>
<div class="nft-card"><strong></strong>bald br√∂thers</div>
<div class="nft-card"><strong></strong>BAE</div>
</div>
</div>
</div>

<!-- FULL WIDTH LEADERBOARD -->
<div class="card">
<div class="card-title" style="margin-bottom:4px;display:flex;align-items:center;flex-wrap:wrap;">
  <span style="display:flex;align-items:center;gap:8px;">
    <span class="dot"></span> 
    <span>Rangl√©tra</span>
  </span>
</div>
<div style="font-size:12px;color:#6b7280;margin-bottom:12px;">Top 500 j√°t√©kosok pontoz√°sa</div>

<div style="position:relative;margin-bottom:12px;">
<input type="text" id="questsLeaderboardSearch" placeholder="Keress felhaszn√°l√≥t vagy wallet c√≠met..." oninput="filterQuestsLeaderboard()" style="width:100%;padding:10px 36px 10px 12px;border-radius:10px;border:1px solid #e5e7eb;font-size:13px;outline:none;background:white;">
<span style="position:absolute;right:12px;top:50%;transform:translateY(-50%);opacity:0.5;">üîç</span>
</div>

<div style="border:1px solid #e5e7eb;border-radius:10px;background:white;overflow:hidden;">
<div style="background:#f9fafb;padding:10px 14px;display:grid;grid-template-columns:80px 1.2fr 2fr 1fr;gap:12px;font-size:12px;font-weight:600;color:#6b7280;border-bottom:2px solid #e5e7eb;position:sticky;top:0;z-index:10;">
<div>Rang</div>
<div>Felhaszn√°l√≥</div>
<div>C√≠m</div>
<div style="text-align:right;">Pontok</div>
</div>

<div id="questsLeaderboardRows" style="max-height:450px;overflow-y:auto;">
<!-- JavaScript gener√°lja -->
</div>
</div>

<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:20px;">
  <div style="background:white;border:1px solid #e5e7eb;border-radius:12px;padding:20px;text-align:center;">
    <div style="font-size:28px;font-weight:800;color:#6a3df5;margin-bottom:6px;">500</div>
    <div style="font-size:13px;color:#6b7280;">√ñsszes j√°t√©kos</div>
  </div>
  <div style="background:white;border:1px solid #e5e7eb;border-radius:12px;padding:20px;text-align:center;">
    <div style="font-size:28px;font-weight:800;color:#6a3df5;margin-bottom:6px;">21,222,037</div>
    <div style="font-size:13px;color:#6b7280;">√ñsszesen pontok</div>
  </div>
  <div style="background:white;border:1px solid #e5e7eb;border-radius:12px;padding:20px;text-align:center;">
    <div style="font-size:28px;font-weight:800;color:#6a3df5;margin-bottom:6px;">37.0</div>
    <div style="font-size:13px;color:#6b7280;">√Åtlag k√ºldet√©sek</div>
  </div>
</div>
</div>
</div>
</main>
<!-- SWAP VIEW -->
<main class="view" id="view-swap">
<div class="swap-card">
<div class="swap-header"><h2>Swap</h2></div>
<div class="swap-field">
<div class="swap-row">
<div>
<div class="swap-label-small">You Send</div>
<select class="token-select" id="tokenFrom" onchange="calculateSwap()">
<option value="HYPE">HYPE</option>
<option value="WHYPE">WHYPE</option>
<option value="CKS">CKS Token</option>
<option value="kHYPE">kHYPE</option>
<option value="USDT0">USDT0</option>
<option value="KITTEN">KITTEN</option>
<option value="USDC">USDC</option>
</select>
</div>
<input class="swap-amount-input" id="amountFrom" type="number" value="1.20" oninput="calculateSwap()"/>
</div>
</div>
<div class="swap-center-icon" onclick="swapTokens()">‚áÖ</div>
<div class="swap-field">
<div class="swap-row">
<div>
<div class="swap-label-small">You Receive</div>
<select class="token-select" id="tokenTo" onchange="calculateSwap()">
<option value="CKS">CKS Token</option>
<option value="HYPE">HYPE</option>
<option value="WHYPE">WHYPE</option>
<option value="USDT0">USDT0</option>
<option value="kHYPE">kHYPE</option>
<option value="KITTEN">KITTEN</option>
<option value="USDC">USDC</option>
</select>
</div>
<input class="swap-amount-input" id="amountTo" type="number" value="12.89" readonly/>
</div>
</div>
<button class="swap-btn" id="swapBtn" onclick="executeSwap()">Swap</button>
</div>
</main>
<!-- AIRDROP VIEW -->
<main class="view" id="view-airdrop">
<div style="text-align:center; padding:40px;">
<h1>Airdrop Page</h1>
<p>The airdrop details are coming soon.
      We're finalizing the rewards, rules, and participation steps.
      Stay tuned ‚Äî updates dropping very soon! üöÄ</p>
</div>
</main>
<!-- CKS TOKEN VIEW -->
<main class="view" id="view-cks">
<div style="text-align:center; padding:40px;">
<h1>CKS Token Info</h1>
<p>Official token information is coming soon.
      Tokenomics, utilities, and the full documentation are currently being prepared.
      Launch incoming‚Ä¶ üî•</p>
</div>
</main>
</div>

<script>
// GLOB√ÅLIS V√ÅLTOZ√ìK
let walletConnected = false;
let walletAddress = '';
let totalPoints = 0;
let completedCount = 0;

// VIEW V√ÅLT√ÅS
function showView(event, viewName) {
  // √ñsszes view elrejt√©se
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  // √ñsszes gomb inactive
  document.querySelectorAll('.top-nav-btn').forEach(btn => btn.classList.remove('active'));
  
  // Akt√≠v view megjelen√≠t√©se
  document.getElementById('view-' + viewName).classList.add('active');
  
  // Akt√≠v gomb kijel√∂l√©se
  if (event && event.target) {
    event.target.classList.add('active');
  }
}

// WALLET CSATLAKOZ√ÅS
async function connectWallet() {
  if (typeof window.ethereum === 'undefined') {
    alert('ü¶ä K√©rlek telep√≠tsd a MetaMask-ot!\n\nLet√∂lt√©s: https://metamask.io');
    window.open('https://metamask.io/download/', '_blank');
    return;
  }
  
  try {
    // El≈ësz√∂r k√©rj√ºnk explicit enged√©lyt (ez mindig popup-ot hoz)
    await window.ethereum.request({
      method: 'wallet_requestPermissions',
      params: [{ eth_accounts: {} }]
    });
    
    // Majd k√©rj√ºk az accountokat
    const accounts = await window.ethereum.request({ 
      method: 'eth_requestAccounts' 
    });
    
    if (accounts.length === 0) {
      alert('‚ùå Nem v√°lasztott√°l ki wallet c√≠met!');
      return;
    }
    
    walletAddress = accounts[0];
    walletConnected = true;
    
    // Gomb friss√≠t√©se
    updateWalletButton();
    
    // Swap gomb enged√©lyez√©se
    document.getElementById('swapBtn').disabled = false;
    
    showNotification('‚úÖ Wallet sikeresen csatlakoztatva!');
  } catch (error) {
    console.error('Wallet csatlakoz√°si hiba:', error);
    
    if (error.code === 4001) {
      // Felhaszn√°l√≥ visszautas√≠totta
      showNotification('‚ùå Csatlakoz√°s visszautas√≠tva');
    } else {
      alert('‚ùå Hiba t√∂rt√©nt a wallet csatlakoztat√°sa sor√°n!\n\n' + error.message);
    }
  }
}

// WALLET LEV√ÅLASZT√ÅS
function disconnectWallet() {
  walletConnected = false;
  walletAddress = '';
  
  // Gomb vissza√°ll√≠t√°sa
  document.getElementById('walletText').textContent = 'Connect Wallet';
  document.getElementById('walletBtn').style.background = '#f9fafb';
  document.getElementById('walletBtn').style.borderColor = '#e5e7eb';
  
  // Swap gomb letilt√°sa
  document.getElementById('swapBtn').disabled = true;
  
  // Session t√∂rl√©se
  sessionStorage.removeItem('wallet_address');
  
  showNotification('üëã Wallet lev√°lasztva');
}

// WALLET GOMB FRISS√çT√âSE
function updateWalletButton() {
  const shortAddress = walletAddress.slice(0, 6) + '...' + walletAddress.slice(-4);
  document.getElementById('walletText').textContent = shortAddress;
  document.getElementById('walletBtn').style.background = 'linear-gradient(135deg, #e2d6ff, #d6f5e3)';
  document.getElementById('walletBtn').style.borderColor = '#6a3df5';
  
  // Wallet c√≠m ment√©se
  sessionStorage.setItem('wallet_address', walletAddress);
}

// WALLET GOMB TOGGLE
function toggleWallet() {
  if (walletConnected) {
    // Ha csatlakozva van, akkor k√©rdezz√ºk meg mit akar
    const result = confirm('üîå Szeretn√©d lev√°lasztani a wallet-et?');
    if (result) {
      disconnectWallet();
    }
  } else {
    // Ha nincs csatlakozva, csatlakoztat√°s
    connectWallet();
  }
}

// TWITTER LOGIN (VAL√ìDI API)
function loginWithTwitter() {
  // √Åtir√°ny√≠t√°s a val√≥di Twitter OAuth endpoint-ra
  window.location.href = "https://catkitsune-site.vercel.app/api/twitter-login";
}

// TWITTER USER BET√ñLT√âSE (URL param√©terekb≈ël)
async function loadTwitterUser() {
  // Ellen≈ërizz√ºk az URL param√©tereket
  const name = getQueryParam("name");
  const username = getQueryParam("username");
  const avatar = getQueryParam("avatar");
  
  if (username && avatar) {
    // Twitter gomb elrejt√©se
    document.getElementById('twitterBtn').style.display = 'none';
    
    // Avatar megjelen√≠t√©se
    const av = document.getElementById('twitterAvatar');
    const decodedAvatar = decodeURIComponent(avatar);
    const decodedUsername = decodeURIComponent(username);
    const decodedName = name ? decodeURIComponent(name) : decodedUsername;
    
    av.innerHTML = `
      <img src="${decodedAvatar}" style="width:30px;height:30px;border-radius:50%;border:2px solid #1da1f2;">
      <span style="font-weight:600;">@${decodedUsername}</span>
    `;
    av.style.display = 'flex';
    
    showNotification(`üê¶ Bejelentkezve: @${decodedUsername}`);
    
    // User adatok ment√©se
    sessionStorage.setItem('twitter_user', JSON.stringify({
      name: decodedName,
      username: decodedUsername,
      avatar: decodedAvatar
    }));
    
    // URL tiszt√≠t√°sa (elt√°vol√≠tjuk a param√©tereket)
    window.history.replaceState({}, document.title, window.location.pathname);
    return;
  }
  
  // Ellen≈ërizz√ºk a session storage-t
  const savedUser = sessionStorage.getItem('twitter_user');
  if (savedUser) {
    try {
      const user = JSON.parse(savedUser);
      document.getElementById('twitterBtn').style.display = 'none';
      const av = document.getElementById('twitterAvatar');
      av.innerHTML = `
        <img src="${user.avatar}" style="width:30px;height:30px;border-radius:50%;border:2px solid #1da1f2;">
        <span style="font-weight:600;">@${user.username}</span>
      `;
      av.style.display = 'flex';
    } catch (e) {
      console.error('Error loading saved Twitter user:', e);
    }
  }
}

function getQueryParam(name) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(name);
}

// QUEST TELJES√çT√âSE
function completeQuest(element, points) {
  const checkbox = element.querySelector('.mission-check');
  
  // Ha m√°r teljes√≠tve van, ne csin√°ljunk semmit
  if (checkbox.classList.contains('completed')) {
    return;
  }
  
  // Teljes√≠t√©s jelz√©se
  checkbox.classList.add('completed');
  element.style.opacity = '0.7';
  element.style.pointerEvents = 'none';
  
  // Pontok hozz√°ad√°sa
  totalPoints += points;
  completedCount++;
  
  // UI friss√≠t√©se
  document.getElementById('totalPoints').textContent = totalPoints;
  document.getElementById('completedQuests').textContent = completedCount;
  document.getElementById('userLeaderPoints').textContent = totalPoints + ' EP';
  
  // Anim√°ci√≥
  element.style.transform = 'scale(0.98)';
  setTimeout(() => {
    element.style.transform = 'scale(1)';
  }, 200);
  
  // √ârtes√≠t√©s
  showNotification(`+${points} EP szerzett! üéâ`);
}

// √âRTES√çT√âS MEGJELEN√çT√âSE
function showNotification(message) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 80px;
    right: 20px;
    background: linear-gradient(135deg, #6a3df5, #22c55e);
    color: white;
    padding: 12px 20px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 14px;
    z-index: 1000;
    animation: slideIn 0.3s ease;
    box-shadow: 0 10px 30px rgba(106, 61, 245, 0.3);
  `;
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// SWAP FUNKCI√ìK
const exchangeRates = {
  'HYPE': 1.0,
  'WHYPE': 1.0,
  'CKS': 10.5,
  'kHYPE': 0.95,
  'USDT0': 1.2,
  'KITTEN': 0.15,
  'USDC': 1.21
};

function calculateSwap() {
  const fromToken = document.getElementById('tokenFrom').value;
  const toToken = document.getElementById('tokenTo').value;
  const fromAmount = parseFloat(document.getElementById('amountFrom').value) || 0;
  
  if (fromToken === toToken) {
    document.getElementById('amountTo').value = fromAmount.toFixed(2);
    return;
  }
  
  const fromRate = exchangeRates[fromToken] || 1;
  const toRate = exchangeRates[toToken] || 1;
  
  const result = (fromAmount * fromRate / toRate).toFixed(2);
  document.getElementById('amountTo').value = result;
}

function swapTokens() {
  const fromSelect = document.getElementById('tokenFrom');
  const toSelect = document.getElementById('tokenTo');
  const fromInput = document.getElementById('amountFrom');
  const toInput = document.getElementById('amountTo');
  
  // Tokenek cser√©je
  const tempToken = fromSelect.value;
  fromSelect.value = toSelect.value;
  toSelect.value = tempToken;
  
  // √ârt√©kek cser√©je
  const tempAmount = fromInput.value;
  fromInput.value = toInput.value;
  toInput.value = tempAmount;
  
  calculateSwap();
}

function executeSwap() {
  if (!walletConnected) {
    alert('El≈ësz√∂r csatlakoztasd a walletodat! üíº');
    return;
  }
  
  const fromToken = document.getElementById('tokenFrom').value;
  const toToken = document.getElementById('tokenTo').value;
  const fromAmount = document.getElementById('amountFrom').value;
  const toAmount = document.getElementById('amountTo').value;
  
  if (!fromAmount || parseFloat(fromAmount) <= 0) {
    alert('Adj meg egy √©rv√©nyes √∂sszeget! üî¢');
    return;
  }
  
  // Swap szimul√°ci√≥
  const swapBtn = document.getElementById('swapBtn');
  swapBtn.textContent = 'Swapping...';
  swapBtn.disabled = true;
  
  setTimeout(() => {
    showNotification(`‚úÖ Swap sikeres! ${fromAmount} ${fromToken} ‚Üí ${toAmount} ${toToken}`);
    swapBtn.textContent = 'Swap';
    swapBtn.disabled = false;
    
    // Quest teljes√≠t√©s (ha $10 felett van)
    const usdValue = parseFloat(fromAmount) * (exchangeRates[fromToken] || 1);
    if (usdValue >= 10) {
      const swapQuest = document.querySelector('.mission-item:nth-child(3)');
      if (swapQuest && !swapQuest.querySelector('.mission-check').classList.contains('completed')) {
        setTimeout(() => completeQuest(swapQuest, 150), 1000);
      }
    }
  }, 2000);
}

// ANIM√ÅCI√ìK
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }
`;
document.head.appendChild(style);

// INICIALIZ√ÅL√ÅS
window.onload = function() {
  calculateSwap();
  loadTwitterUser();
  generateQuestsLeaderboard();
  generateLeaderboard();
  
  // Wallet visszat√∂lt√©se ha volt csatlakoztatva
  const savedWallet = sessionStorage.getItem('wallet_address');
  if (savedWallet && typeof window.ethereum !== 'undefined') {
    walletAddress = savedWallet;
    walletConnected = true;
    updateWalletButton();
    document.getElementById('swapBtn').disabled = false;
  }
};

// MetaMask accountok v√°ltoz√°s√°nak figyel√©se
if (typeof window.ethereum !== 'undefined') {
  window.ethereum.on('accountsChanged', function (accounts) {
    if (accounts.length === 0) {
      // Wallet lecsatlakozott
      disconnectWallet();
      showNotification('üëã Wallet lecsatlakoztatva a MetaMask-ban');
    } else if (walletConnected) {
      // Account v√°lt√°s
      walletAddress = accounts[0];
      updateWalletButton();
      showNotification('üîÑ Wallet c√≠m megv√°ltozott');
    }
  });
  
  // Chain v√°ltoz√°s figyel√©se
  window.ethereum.on('chainChanged', function () {
    showNotification('üîó H√°l√≥zat megv√°ltozott');
    window.location.reload();
  });
}

// LEADERBOARD GENER√ÅL√ÅS
const baseNames = [
  "Czaban Eszter", "Czaban L√°szl√≥", "Balogh S√°ndor", "Ill√©s Katalin", "Ill√©s M√°rk",
  "Kiss R√≥bert", "Papp G√°bor", "Hal√°sz √âva", "G√°l Eszter", "Balogh √âva",
  "G√°l Laura", "Nagy P√©ter", "T√≥th Anna", "Kov√°cs J√°nos", "Szab√≥ M√°ria",
  "Horv√°th Istv√°n", "Varga Zs√≥fia", "Moln√°r Ferenc", "Simon Katalin", "Fekete G√°bor",
  "Farkas √âva", "Tak√°cs P√©ter", "Juh√°sz Anna", "Luk√°cs J√°nos", "M√©sz√°ros M√°ria",
  "Ol√°h Istv√°n", "Papp Zs√≥fia", "Szil√°gyi Ferenc", "Heged≈±s Katalin", "R√°cz G√°bor"
];

// Gener√°lunk 500 random j√°t√©kost
function generateRandomPlayers() {
  const players = [];
  for (let i = 0; i < 500; i++) {
    const name = baseNames[i % baseNames.length] + (i >= 30 ? ` ${Math.floor(i/30)}` : '');
    const randomAddress = '0x' + Math.random().toString(16).substring(2, 15);
    const points = Math.floor(Math.random() * 50000) + 20000; // 20k-70k k√∂z√∂tt
    players.push({ name, address: randomAddress, points });
  }
  // Rendez√©s pontsz√°m szerint cs√∂kken≈ë sorrendben
  return players.sort((a, b) => b.points - a.points);
}

const leaderboardData = generateRandomPlayers();

let filteredData = [...leaderboardData];
let filteredQuestsData = [...leaderboardData];

// QUESTS OLDAL MINI LEADERBOARD
function generateQuestsLeaderboard() {
  const container = document.getElementById('questsLeaderboardRows');
  if (!container) return;
  
  const currentUser = walletAddress ? walletAddress.toLowerCase() : '';
  
  filteredQuestsData.sort((a, b) => b.points - a.points);
  
  container.innerHTML = filteredQuestsData.map((player, index) => {
    const rank = index + 1;
    const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : '';
    const isCurrentUser = player.address.toLowerCase() === currentUser;
    
    return `
      <div style="display:grid;grid-template-columns:80px 1.2fr 2fr 1fr;gap:12px;padding:14px 16px;border-bottom:1px solid #f3f4f6;font-size:13px;align-items:center;transition:0.2s;${isCurrentUser ? 'background:#f2ecff;border-left:3px solid #6a3df5;' : ''}">
        <div style="font-weight:700;display:flex;align-items:center;gap:8px;">
          ${medal ? `<span style="font-size:18px;">${medal}</span>` : `<span>#${rank}</span>`}
        </div>
        <div style="font-weight:600;">${player.name}</div>
        <div style="font-family:monospace;font-size:12px;color:#6b7280;">${player.address}</div>
        <div style="text-align:right;font-weight:700;color:#6a3df5;">${player.points.toLocaleString()}</div>
      </div>
    `;
  }).join('');
}

function filterQuestsLeaderboard() {
  const searchTerm = document.getElementById('questsLeaderboardSearch').value.toLowerCase();
  
  if (!searchTerm) {
    filteredQuestsData = [...leaderboardData];
  } else {
    filteredQuestsData = leaderboardData.filter(player => 
      player.name.toLowerCase().includes(searchTerm) ||
      player.address.toLowerCase().includes(searchTerm)
    );
  }
  
  generateQuestsLeaderboard();
}

// FULL LEADERBOARD OLDAL
function generateLeaderboard() {
  const container = document.getElementById('leaderboardRows');
  if (!container) return;
  
  const currentUser = walletAddress ? walletAddress.toLowerCase() : '';
  
  filteredData.sort((a, b) => b.points - a.points);
  
  container.innerHTML = filteredData.map((player, index) => {
    const rank = index + 1;
    const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : '';
    const isCurrentUser = player.address.toLowerCase() === currentUser;
    
    return `
      <div class="leaderboard-row ${isCurrentUser ? 'highlight' : ''}">
        <div class="rank-cell">
          ${medal ? `<span class="rank-medal">${medal}</span>` : `<span>#${rank}</span>`}
        </div>
        <div class="user-cell">${player.name}</div>
        <div class="address-cell">${player.address}</div>
        <div class="points-cell">${player.points.toLocaleString()}</div>
      </div>
    `;
  }).join('');
}

function filterLeaderboard() {
  const searchTerm = document.getElementById('leaderboardSearch').value.toLowerCase();
  
  if (!searchTerm) {
    filteredData = [...leaderboardData];
  } else {
    filteredData = leaderboardData.filter(player => 
      player.name.toLowerCase().includes(searchTerm) ||
      player.address.toLowerCase().includes(searchTerm)
    );
  }
  
  generateLeaderboard();
}
</script>
</body>
</html>
