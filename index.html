<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>CatKitSune ‚Äì Quests & Swap</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<!-- üî• MINT TAB STYLING - RED VERSION -->
<style>
.top-nav-btn.mint-tab {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
  color: white !important;
  border: 1px solid #ef4444 !important;
  font-weight: 700;
  box-shadow: 0 2px 8px rgba(239, 68, 68, 0.25);
  transition: all 0.3s ease;
}

.top-nav-btn.mint-tab:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}

@keyframes subtle-pulse-red {
  0%, 100% {
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.25);
  }
  50% {
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.45);
  }
}

.top-nav-btn.mint-tab {
  animation: subtle-pulse-red 2s ease-in-out infinite;
}

/* Staking Slot Styles */
.staking-slot {
  transition: all 0.3s ease !important;
}

.staking-slot:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 12px rgba(20, 184, 166, 0.2);
}
</style>

<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg-main: #f0fdf9;
      --bg-card: #ffffff;
      --primary: #14b8a6;
      --primary-soft: #ccfbf1;
      --accent-green: #10b981;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --shadow-card: 0 10px 30px rgba(15, 23, 42, 0.12);
    }

    body {
      font-family: "Inter", sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
      min-height: 100vh;
    }

    .app { min-height: 100vh; display: flex; flex-direction: column; }

    header {
      padding: 2px 16px;
      background: var(--bg-main);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
    }

    .logo {
      font-size: 14px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .paw-icon {
      width: 24px;
      height: 24px;
      display: inline-block;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><ellipse cx="65" cy="50" rx="23" ry="33" fill="%2314b8a6"/><ellipse cx="135" cy="50" rx="23" ry="33" fill="%2314b8a6"/><ellipse cx="35" cy="80" rx="20" ry="30" fill="%2314b8a6" transform="rotate(-25 35 80)"/><ellipse cx="165" cy="80" rx="20" ry="30" fill="%2314b8a6" transform="rotate(25 165 80)"/><ellipse cx="100" cy="130" rx="55" ry="50" fill="%2314b8a6"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    .top-actions { display: flex; align-items: center; gap: 8px; }

    .login-btn {
      font-size: 12px; padding: 6px 12px; border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      cursor: pointer;
      display:flex;
      align-items:center;
      gap:6px;
      transition: all 0.2s;
    }

    .login-btn:hover {
      background: #f3f4f6;
      transform: translateY(-1px);
    }

    .avatar {
      width: 26px; height: 26px; border-radius: 50%;
      background: linear-gradient(135deg, #14b8a6, #10b981);
    }

    main { flex: 1; padding: 0 12px 80px; max-width: 1200px; margin: 0 auto; width: 100%; }

    .top-nav {
      margin-top: 20px;
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .top-nav-btn {
      padding: 4px 14px;
      font-size: 13px;
      border-radius: 999px;
      border: 1px solid #d4d4d8;
      background: #fff;
      cursor: pointer;
      transition: 0.2s;
    }

    .top-nav-btn:hover { background: #f3f4f6; }

    .top-nav-btn.active {
      background: #14b8a6;
      color: white;
      border-color: #14b8a6;
    }

.view {
  display: none;
  width: 100%;
}

.view.active {
  display: block;
}

.views-container {
  position: relative;
}

    .hero-card {
      background: linear-gradient(180deg, #f0fdf9 0%, #ccfbf1 100%);
      border-radius: 24px;
      padding: 16px 14px 14px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      margin-bottom: 0;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .hero-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(20, 184, 166, 0.1), rgba(16, 185, 129, 0.1));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }

    .hero-card:hover::before {
      opacity: 1;
    }

    .hero-card > * {
      position: relative;
      z-index: 1;
    }

    .hero-card:hover {
      box-shadow: 0 12px 40px rgba(20, 184, 166, 0.2);
      transform: translateY(-2px);
    }

    .hero-title { font-size: 18px; font-weight: 800; margin-bottom: 3px; }
    .hero-sub { font-size: 12px; color: var(--text-muted); margin-bottom: 12px; }

    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px; margin-bottom: 0;
    }

    .stat-card {
      background: #fff;
      border-radius: 16px;
      padding: 8px 6px;
      border: 1px solid var(--primary-soft);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(20, 184, 166, 0.1), rgba(16, 185, 129, 0.1));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-card > * {
      position: relative;
      z-index: 1;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(20, 184, 166, 0.15);
      border-color: var(--primary);
      background: white;
    }

    .stat-label { font-size: 10px; color: var(--text-muted); margin-bottom: 3px; }
    .stat-value { font-size: 16px; font-weight: 700; }

    .content-grid {
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    .quests-section {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 32px;
    }

    .card {
      background: var(--bg-card);
      border-radius: 24px;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 18px 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(20, 184, 166, 0.05), rgba(16, 185, 129, 0.05));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
      pointer-events: none;
    }

    .card:hover::before {
      opacity: 1;
    }

    .card > * {
      position: relative;
      z-index: 1;
    }

    .card:hover {
      box-shadow: 0 12px 40px rgba(20, 184, 166, 0.15);
      transform: translateY(-2px);
      border-color: var(--primary-soft);
    }

    .card div[style*="background:linear-gradient"] {
      transition: all 0.3s ease;
    }
    
    .card div[style*="background:linear-gradient"]:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .card-title {
      font-size: 14px; font-weight: 700; margin-bottom: 12px;
      display: flex; align-items: center; gap: 8px;
    }

    .card-title span.dot {
      width: 6px; height: 6px; border-radius: 999px; background: var(--primary);
    }

    .mission-list { display: flex; flex-direction: column; gap: 8px; }

    .mission-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 9px 10px; border-radius: 12px;
      border: 1px solid #e5e7eb; background: #f9fafb;
      font-size: 12px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .mission-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(106, 61, 245, 0.1), rgba(34, 197, 94, 0.1));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }

    .mission-item:hover::before {
      opacity: 1;
    }

    .mission-item > * {
      position: relative;
      z-index: 1;
    }

    .mission-item:hover {
      border-color: var(--primary);
      background: white;
      box-shadow: 0 6px 16px rgba(106, 61, 245, 0.15);
      transform: translateY(-2px);
    }

    .mission-left { display: flex; align-items: center; gap: 10px; }

    .mission-check {
      width: 16px; height: 16px; border-radius: 999px;
      border: 2px solid #d1d5db; background: #fff;
    }

    .mission-check.completed {
      background: var(--accent-green);
      border-color: var(--accent-green);
    }

    .mission-text-title { font-weight: 600; margin-bottom: 2px; }
    .mission-text-sub { color: var(--text-muted); font-size: 11px; }

    .mission-points { color: #16a34a; font-weight: 600; font-size: 12px; }

    .nft-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 10px;
    }

    .nft-card {
      border-radius: 10px;
      border: 1px dashed #d4d4d8;
      background: #f9fafb;
      padding: 14px 8px;
      text-align: center;
      font-size: 11px;
      color: var(--text-muted);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 90px;
    }

    .nft-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(106, 61, 245, 0.1), rgba(34, 197, 94, 0.1));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }

    .nft-card:hover {
      transform: translateY(-4px);
      border-color: var(--primary);
      border-style: solid;
      background: white;
      box-shadow: 0 8px 24px rgba(106, 61, 245, 0.25);
    }

    .nft-card:hover::before {
      opacity: 1;
    }

    .nft-card strong {
      display: block;
      font-size: 10.5px;
      color: var(--text-main);
      font-weight: 600;
      position: relative;
      z-index: 1;
      line-height: 1.3;
      word-break: break-word;
      max-width: 100%;
      text-align: center;
    }
    
    .nft-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
    }

    .nft-count {
      display: block;
      font-size: 10px;
      color: var(--text-muted);
      font-weight: 500;
      text-align: center;
      margin-top: 4px;
    }

    @media (max-width: 768px) {
      .quests-section {
        grid-template-columns: 1fr;
      }
      .nft-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    #view-roadmap .content-grid {
      margin-top: 0 !important;
      padding-top: 0 !important;
    }
    
    #view-airdrop .content-grid {
      margin-top: 0 !important;
      padding-top: 0 !important;
    }
    
    #view-token .content-grid {
      margin-top: 0 !important;
      padding-top: 0 !important;
    }

    #view-roadmap,
    #view-airdrop,
    #view-token,
    #view-staking {
      margin-top: 0 !important;
      padding-top: 0 !important;
    }
  </style>
</head>
<body>
<div class="app">
<header>
<div class="logo" onclick="showView(event, 'quests')">
<span class="paw-icon"></span>
<span>CatKitSune</span>
</div>
<div class="top-actions">
<button class="login-btn mint-tab" onclick="window.location.href='/launch'" style="margin-right: 8px;">
üî• Mint
</button>
<button class="login-btn" id="walletBtn" onclick="toggleWallet()">
<img src="https://cdn-icons-png.flaticon.com/512/891/891462.png" style="width:18px;"/>
<span id="walletText">Connect Wallet</span>
</button>
<button class="login-btn" id="twitterBtn" onclick="loginWithTwitter()">
<img src="https://cdn-icons-png.flaticon.com/512/733/733579.png" style="width:18px;"/>
Login with Twitter
</button>
<div id="twitterAvatar" style="display:none; align-items:center; gap:6px;"></div>
<div class="avatar"></div>
</div>
</header>

<div class="views-container">

<main class="view active" id="view-quests">
<div class="hero-card">
<div class="hero-title">Complete quests. Earn points. Climb the leaderboard.</div>
<div class="hero-sub">Join the community and reach the highest level!</div>
<div class="stats-row">
<div class="stat-card"><div class="stat-label">Total Points</div><div class="stat-value" id="totalPoints">0</div></div>
<div class="stat-card"><div class="stat-label">Quests</div><div class="stat-value">10</div></div>
<div class="stat-card"><div class="stat-label">Completed</div><div class="stat-value" id="completedQuests">0</div></div>
<div class="stat-card"><div class="stat-label">Rank</div><div class="stat-value">#TBD</div></div>
</div>
</div>

<div class="top-nav">
<button class="top-nav-btn active" onclick="showView(event, 'quests')">üéÆ</button>
<button class="top-nav-btn" onclick="showView(event, 'roadmap')">üó∫Ô∏è</button>
<button class="top-nav-btn" onclick="showView(event, 'staking')">üíé</button>
</div>

<div class="content-grid">

<div class="card">
<div class="card-title" style="margin-bottom:20px;">
<span class="dot"></span> Leaderboard
</div>

<div style="position:relative;margin-bottom:20px;">
<input type="text" id="questsLeaderboardSearch" placeholder="Search for user or wallet address..." oninput="filterQuestsLeaderboard()" style="width:100%;padding:10px 36px 10px 12px;border-radius:10px;border:1px solid #e5e7eb;font-size:13px;outline:none;background:white;transition:all 0.3s ease;" onfocus="this.style.borderColor='#6a3df5';this.style.boxShadow='0 0 0 3px rgba(106,61,245,0.1)'" onblur="this.style.borderColor='#e5e7eb';this.style.boxShadow='none'">
<span style="position:absolute;right:12px;top:50%;transform:translateY(-50%);opacity:0.5;">üîç</span>
</div>

<div style="border:1px solid #e5e7eb;border-radius:10px;background:white;overflow:hidden;">
<div style="background:#f9fafb;padding:10px 14px;display:grid;grid-template-columns:80px 2fr 1fr;gap:12px;font-size:12px;font-weight:600;color:#6b7280;border-bottom:2px solid #e5e7eb;position:sticky;top:0;z-index:10;">
<div>Rank</div>
<div>User</div>
<div style="text-align:right;">Points</div>
</div>

<div id="questsLeaderboardRows" style="max-height:250px;overflow-y:auto;">
</div>
</div>
</div>

<div class="quests-section">
<div class="card">
<div class="card-title"><span class="dot"></span> Quests</div>
<div style="background:#fff3cd;border:1px solid #ffc107;border-radius:8px;padding:10px;margin-bottom:12px;font-size:12px;color:#856404;">
‚ö†Ô∏è <strong>Not Live Yet</strong> - Quests are currently in testing phase
</div>
<div class="mission-list">
<div class="mission-item" onclick="completeQuest(this, 150)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Follow on X</div>
<div class="mission-text-sub">Follow <a href="https://x.com/GborSzakl1" target="_blank" onclick="event.stopPropagation()">@GborSzakl1</a> on X.</div>
</div>
</div>
<div class="mission-points">+150 EP</div>
</div>
<div class="mission-item" onclick="completeQuest(this, 300)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Mint the CatKitSune NFT</div>
<div class="mission-text-sub">Airdrop bonus reward.</div>
</div>
</div>
<div class="mission-points">+300 EP</div>
</div>
<div class="mission-item" onclick="completeQuest(this, 150)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Swap on CatKitSune</div>
<div class="mission-text-sub">Make a swap worth at least $10.</div>
</div>
</div>
<div class="mission-points">+150 EP</div>
</div>
<div class="mission-item" onclick="completeQuest(this, 250)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Share on X</div>
<div class="mission-text-sub"><a href="https://x.com/GborSzakl1/status/1989254176568672659" target="_blank" onclick="event.stopPropagation()">Open Tweet</a></div>
</div>
</div>
<div class="mission-points">+250 EP</div>
</div>
<div class="mission-item" onclick="completeQuest(this, 500)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Bridge to HYPE</div>
<div class="mission-text-sub">Bridge $10 to HYPE.</div>
</div>
</div>
<div class="mission-points">+500 EP</div>
</div>
<div class="mission-item" onclick="completeQuest(this, 300)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Mini Mover</div>
<div class="mission-text-sub">Transact $50 today.</div>
</div>
</div>
<div class="mission-points">+300 EP</div>
</div>
<div class="mission-item" onclick="completeQuest(this, 300)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Earn Boost</div>
<div class="mission-text-sub">Complete 3 tasks.</div>
</div>
</div>
<div class="mission-points">+300 EP</div>
</div>
<div class="mission-item" onclick="completeQuest(this, 800)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Weekly Volume</div>
<div class="mission-text-sub">Transact $2000.</div>
</div>
</div>
<div class="mission-points">+800 EP</div>
</div>
<div class="mission-item" onclick="completeQuest(this, 200)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Swap It Up</div>
<div class="mission-text-sub">Swap $10 on KittenSwap.</div>
</div>
</div>
<div class="mission-points">+200 EP</div>
</div>
<div class="mission-item" onclick="completeQuest(this, 1200)">
<div class="mission-left">
<div class="mission-check"></div>
<div>
<div class="mission-text-title">Hold all NFTs</div>
<div class="mission-text-sub">Own 1 from each listed collection.</div>
</div>
</div>
<div class="mission-points">+1200 EP</div>
</div>
</div>
</div>

<div class="card">
<div class="card-title"><span class="dot"></span> NFT Gallery</div>
<div class="nft-grid">
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="0">
  <div class="nft-card">
    <strong>Wealthy Hypo Babies</strong>
  </div>
  <span class="nft-count" id="nft-0" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="1">
  <div class="nft-card">
    <strong>Tiny Hyper Cats</strong>
  </div>
  <span class="nft-count" id="nft-1" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="2">
  <div class="nft-card">
    <strong>Hypurr</strong>
  </div>
  <span class="nft-count" id="nft-2" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="3">
  <div class="nft-card">
    <strong>Hyperian Genesis</strong>
  </div>
  <span class="nft-count" id="nft-3" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="4">
  <div class="nft-card">
    <strong>CatKitSune</strong>
  </div>
  <span class="nft-count" id="nft-4" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="5">
  <div class="nft-card">
    <strong>Illumeownati by Catbal</strong>
  </div>
  <span class="nft-count" id="nft-5" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="6">
  <div class="nft-card">
    <strong>PiP & Friends</strong>
  </div>
  <span class="nft-count" id="nft-6" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="7">
  <div class="nft-card">
    <strong>Hypers</strong>
  </div>
  <span class="nft-count" id="nft-7" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="8">
  <div class="nft-card">
    <strong>Mechacats</strong>
  </div>
  <span class="nft-count" id="nft-8" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="9">
  <div class="nft-card">
    <strong>LQnians</strong>
  </div>
  <span class="nft-count" id="nft-9" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="10">
  <div class="nft-card">
    <strong>bald br√∂thers</strong>
  </div>
  <span class="nft-count" id="nft-10" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="11">
  <div class="nft-card">
    <strong>BAE</strong>
  </div>
  <span class="nft-count" id="nft-11" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="12">
  <div class="nft-card">
    <strong>Hypo</strong>
  </div>
  <span class="nft-count" id="nft-12" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="13">
  <div class="nft-card">
    <strong>Hyperian Legacy</strong>
  </div>
  <span class="nft-count" id="nft-13" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
<div style="display:flex;flex-direction:column;align-items:center;" data-nft-index="14">
  <div class="nft-card">
    <strong>Odd Otties</strong>
  </div>
  <span class="nft-count" id="nft-14" style="margin-top:4px;font-size:10px;">0 owned</span>
</div>
</div>
</div>
</div>
</div>
</div>
</main>

<!-- ROADMAP PAGE -->
<main class="view" id="view-roadmap">
<div class="hero-card">
<div class="hero-title">üó∫Ô∏è CatKitSune Roadmap</div>
<div class="hero-sub">Our journey and future plans</div>
</div>

<div class="top-nav">
<button class="top-nav-btn" onclick="showView(event, 'quests')">üéÆ</button>
<button class="top-nav-btn active" onclick="showView(event, 'roadmap')">üó∫Ô∏è</button>
<button class="top-nav-btn" onclick="showView(event, 'staking')">üíé</button>
</div>

<div style="background:linear-gradient(135deg,#fee2e2,#fecaca);padding:10px 14px;border-radius:10px;margin-bottom:10px;border:1px solid #ef4444;">
<div style="font-size:12px;font-weight:700;color:#991b1b;margin-bottom:3px;text-align:center;">üöß Website Under Development</div>
<div style="font-size:10px;color:#7f1d1d;line-height:1.4;text-align:center;">
<strong>Note:</strong> Not all features on this website are fully functional yet. Some sections are still in development and will be activated progressively.
</div>
</div>

<div style="background:linear-gradient(135deg,#fef3c7,#fde68a);padding:10px 14px;border-radius:10px;margin-bottom:16px;border:1px solid #fbbf24;">
<div style="font-size:12px;font-weight:700;color:#92400e;margin-bottom:3px;text-align:center;">‚ö†Ô∏è Important: No Fixed Timeline</div>
<div style="font-size:10px;color:#78350f;line-height:1.4;text-align:center;">
This roadmap is <strong>NOT time-bound</strong>. Progress through each phase at your own pace. Complete prerequisites to unlock next stages.
</div>
</div>

<div class="content-grid">

<!-- PHASE 1: NFT Series System -->
<div class="card">
<div class="card-title"><span class="dot"></span> Phase 1: üé® NFT Series System</div>
<div style="display:flex;flex-direction:column;gap:12px;margin-top:12px;">

<div style="padding:16px;background:linear-gradient(135deg,#f0fdf9,#ccfbf1);border-radius:12px;border-left:4px solid #14b8a6;">
<div style="font-weight:700;font-size:14px;color:#115e59;margin-bottom:6px;">1Ô∏è‚É£ Series 1 NFT ‚Äì Entry Level</div>
<div style="font-size:12px;color:#334155;line-height:1.6;">
<strong>Requirement:</strong> None<br>
<strong>Unlock:</strong> Series 2 minting access<br>
<strong>Chain:</strong> Hyperliquid<br>
<strong>Marketplace:</strong> <a href="https://drip.trade/" target="_blank" style="color:#14b8a6;font-weight:600;">DripTrade</a><br>
<strong>Minting:</strong> <span style="color:#14b8a6;font-weight:600;">Coming Soon</span>
</div>
</div>

<div style="padding:16px;background:linear-gradient(135deg,#fef3c7,#fde68a);border-radius:12px;border-left:4px solid #f59e0b;">
<div style="font-weight:700;font-size:14px;color:#92400e;margin-bottom:6px;">2Ô∏è‚É£ Series 2 NFT ‚Äì Advanced Level</div>
<div style="font-size:12px;color:#334155;line-height:1.6;">
<strong>Requirement:</strong> Own Series 1 NFT<br>
<strong>Unlock:</strong> Series 3 minting access<br>
<strong>Chain:</strong> Hyperliquid<br>
<strong>Marketplace:</strong> <a href="https://drip.trade/" target="_blank" style="color:#f59e0b;font-weight:600;">DripTrade</a><br>
<strong>Minting:</strong> <span style="color:#f59e0b;font-weight:600;">Coming Soon</span>
</div>
</div>

<div style="padding:16px;background:linear-gradient(135deg,#faf5ff,#f3e8ff);border-radius:12px;border-left:4px solid #a855f7;">
<div style="font-weight:700;font-size:14px;color:#6b21a8;margin-bottom:6px;">3Ô∏è‚É£ Series 3 NFT ‚Äì Premium Level + Token Rewards</div>
<div style="font-size:12px;color:#334155;line-height:1.6;">
<strong>Requirement:</strong> Own Series 1 + Series 2 NFTs<br>
<strong>Benefits:</strong><br>
- Token rewards<br>
- Extra airdrop eligibility<br>
<strong>Chain:</strong> Hyperliquid<br>
<strong>Marketplace:</strong> <a href="https://drip.trade/" target="_blank" style="color:#a855f7;font-weight:600;">DripTrade</a><br>
<strong>Minting:</strong> <span style="color:#a855f7;font-weight:600;">Coming Soon</span>
</div>
</div>

</div>
</div>

<!-- PHASE 2 - PHASE 5 remain exactly the same as original -->
<!-- ... keeping rest of roadmap phases unchanged for brevity ... -->

</div>
</main>

<!-- STAKING VIEW -->
<main class="view" id="view-staking">
<div class="page-title" style="text-align:center; margin-bottom:16px;">
<h1 style="font-size:32px; font-weight:800; margin-bottom:8px;">üíé NFT Staking</h1>
<p style="font-size:14px; color:var(--text-muted); margin-bottom:16px;">Stake up to 5 NFTs from each series and earn 5 EP per NFT!</p>

<!-- Navigation Buttons -->
<div style="display:flex; gap:12px; align-items:center; justify-content:center; margin-bottom:24px;">
<button class="top-nav-btn" onclick="showView(event, 'quests')" style="padding:10px 16px; background:white; border:1px solid var(--border); border-radius:999px; cursor:pointer; font-size:18px; transition:all 0.2s; box-shadow:0 1px 3px rgba(0,0,0,0.1);">üéÆ</button>
<button class="top-nav-btn" onclick="showView(event, 'roadmap')" style="padding:10px 16px; background:white; border:1px solid var(--border); border-radius:999px; cursor:pointer; font-size:18px; transition:all 0.2s; box-shadow:0 1px 3px rgba(0,0,0,0.1);">üó∫Ô∏è</button>
<button class="top-nav-btn active" onclick="showView(event, 'staking')" style="padding:10px 16px; background:var(--primary); color:white; border:1px solid var(--primary); border-radius:999px; cursor:pointer; font-size:18px; transition:all 0.2s; box-shadow:0 2px 4px rgba(20,184,166,0.3);">üíé</button>
</div>
</div>

<!-- Staking Info Card -->
<div class="card" style="margin-bottom:20px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.1)); border: 1px solid rgba(168, 85, 247, 0.3);">
<div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
<h3 style="font-size:16px; font-weight:700;">üìä Your Staking Stats</h3>
<div style="display:flex; gap:16px; align-items:center;">
<div style="text-align:center;">
<div style="font-size:11px; color:var(--text-muted); margin-bottom:4px;">Staked NFTs</div>
<div id="totalStaked" style="font-size:20px; font-weight:800; color:var(--primary);">0/15</div>
</div>
<div style="text-align:center;">
<div style="font-size:11px; color:var(--text-muted); margin-bottom:4px;">Total EP Earned</div>
<div id="totalStakingEP" style="font-size:20px; font-weight:800; color:#a855f7;">0</div>
</div>
</div>
</div>
<div style="font-size:13px; color:var(--text-muted); line-height:1.6;">
üí° Stake <strong style="color:var(--primary);">up to 5 NFTs from each series</strong> to earn 5 EP per staked NFT!<br>
<span style="font-size:11px; opacity:0.8;">Contract: 0x2abF2969E5e9cAAa1D3fF3DF4265dFFcda0D8353</span>
</div>
</div>

<!-- Staking Pools by Series -->
<div style="display:grid; gap:16px;">

<!-- Series 1: NFT #1-100 -->
<div class="card staking-pool" data-series="1" style="position:relative; overflow:hidden;">
<div style="position:absolute; top:12px; right:12px; background:linear-gradient(135deg, #a855f7, #ec4899); color:white; padding:4px 12px; border-radius:999px; font-size:11px; font-weight:700;">
+25 EP Max
</div>
<div style="margin-bottom:16px;">
<h3 style="font-size:18px; font-weight:700; margin-bottom:8px; display:flex; align-items:center; gap:8px;">
<span>ü¶ä</span>
<span>Series 1 Staking</span>
<span id="series1-count" style="font-size:14px; color:var(--text-muted); font-weight:500;">(0/5)</span>
</h3>
<p style="font-size:13px; color:var(--text-muted);">Stake up to 5 NFTs from Series 1 (ID #1-100)</p>
</div>

<!-- 5 Staking Slots for Series 1 -->
<div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:12px; margin-bottom:16px;">
<div id="series1-slot0" class="staking-slot" data-series="1" data-slot="0" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(1, 0)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series1-slot1" class="staking-slot" data-series="1" data-slot="1" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(1, 1)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series1-slot2" class="staking-slot" data-series="1" data-slot="2" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(1, 2)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series1-slot3" class="staking-slot" data-series="1" data-slot="3" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(1, 3)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series1-slot4" class="staking-slot" data-series="1" data-slot="4" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(1, 4)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
</div>
</div>

<!-- Series 2: NFT #101-200 -->
<div class="card staking-pool" data-series="2" style="position:relative; overflow:hidden;">
<div style="position:absolute; top:12px; right:12px; background:linear-gradient(135deg, #3b82f6, #8b5cf6); color:white; padding:4px 12px; border-radius:999px; font-size:11px; font-weight:700;">
+25 EP Max
</div>
<div style="margin-bottom:16px;">
<h3 style="font-size:18px; font-weight:700; margin-bottom:8px; display:flex; align-items:center; gap:8px;">
<span>ü¶ä</span>
<span>Series 2 Staking</span>
<span id="series2-count" style="font-size:14px; color:var(--text-muted); font-weight:500;">(0/5)</span>
</h3>
<p style="font-size:13px; color:var(--text-muted);">Stake up to 5 NFTs from Series 2 (ID #101-200)</p>
</div>

<!-- 5 Staking Slots for Series 2 -->
<div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:12px; margin-bottom:16px;">
<div id="series2-slot0" class="staking-slot" data-series="2" data-slot="0" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(2, 0)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series2-slot1" class="staking-slot" data-series="2" data-slot="1" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(2, 1)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series2-slot2" class="staking-slot" data-series="2" data-slot="2" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(2, 2)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series2-slot3" class="staking-slot" data-series="2" data-slot="3" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(2, 3)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series2-slot4" class="staking-slot" data-series="2" data-slot="4" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(2, 4)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
</div>
</div>

<!-- Series 3: NFT #201-300 -->
<div class="card staking-pool" data-series="3" style="position:relative; overflow:hidden;">
<div style="position:absolute; top:12px; right:12px; background:linear-gradient(135deg, #f59e0b, #ef4444); color:white; padding:4px 12px; border-radius:999px; font-size:11px; font-weight:700;">
+25 EP Max
</div>
<div style="margin-bottom:16px;">
<h3 style="font-size:18px; font-weight:700; margin-bottom:8px; display:flex; align-items:center; gap:8px;">
<span>ü¶ä</span>
<span>Series 3 Staking</span>
<span id="series3-count" style="font-size:14px; color:var(--text-muted); font-weight:500;">(0/5)</span>
</h3>
<p style="font-size:13px; color:var(--text-muted);">Stake up to 5 NFTs from Series 3 (ID #201-300)</p>
</div>

<!-- 5 Staking Slots for Series 3 -->
<div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:12px; margin-bottom:16px;">
<div id="series3-slot0" class="staking-slot" data-series="3" data-slot="0" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(3, 0)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series3-slot1" class="staking-slot" data-series="3" data-slot="1" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(3, 1)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series3-slot2" class="staking-slot" data-series="3" data-slot="2" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(3, 2)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series3-slot3" class="staking-slot" data-series="3" data-slot="3" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(3, 3)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
<div id="series3-slot4" class="staking-slot" data-series="3" data-slot="4" style="background:#f9fafb; border:2px dashed #e5e7eb; border-radius:12px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;" onclick="stakeToSlot(3, 4)">
<div style="font-size:32px; opacity:0.3; margin-bottom:8px;">ü¶ä</div>
<div style="font-size:12px; color:var(--text-muted); text-align:center;">Empty Slot</div>
</div>
</div>
</div>

</div>
</main>

</div><!-- /views-container -->

</div><!-- /app -->
<script>
// ==========================================
// FIREBASE CONFIGURATION
// ==========================================
const firebaseConfig = {
  apiKey: "AIzaSyBm9YORem_caRx_FInbPJwqP7BSs9I",
  authDomain: "catkitsune-49fda.firebaseapp.com",
  databaseURL: "https://catkitsune-49fda-default-rtdb.firebaseio.com",
  projectId: "catkitsune-49fda",
  storageBucket: "catkitsune-49fda.appspot.com",
  messagingSenderId: "458357499767",
  appId: "1:458357499767:web:b74a26aae203b0a1a24a5"
};

let firebaseApp;
let database;
let firebaseEnabled = false;

try {
  firebaseApp = firebase.initializeApp(firebaseConfig);
  database = firebase.database();
  firebaseEnabled = true;
  console.log('üî• Firebase initialized successfully!');
} catch (error) {
  console.warn('‚ö†Ô∏è Firebase initialization error:', error);
  firebaseEnabled = false;
}

// ==========================================
// VARIABLES
// ==========================================
let walletConnected = false;
let walletAddress = '';
let totalPoints = 0;
let completedCount = 0;
let nftPointsEarned = 0;

const questsLive = false;

// ==========================================
// NFT COLLECTIONS - ‚úÖ CATKITSUNE ADDED
// ==========================================
const NFT_COLLECTIONS = [
  { 
    name: 'Wealthy Hypo Babies', 
    address: '0x63eb9d77D083cA10C304E28d5191321977fd0Bfb', 
    pointsPerNFT: 1, 
    galleryIndex: 0,
    image: 'https://pbs.twimg.com/profile_images/1876004126938537984/qpRkjcAX_400x400.jpg'
  },
  { 
    name: 'Tiny Hyper Cats', 
    address: '0xCC3D60fF11a268606C6a57bD6Db74b4208f1D30c', 
    pointsPerNFT: 1, 
    galleryIndex: 1,
    image: 'https://static.drip.trade/collections/tiny-hyper-cat_pfp.jpg'
  },
  { 
    name: 'Hypurr', 
    address: '0x9125E2d6827a00B0F8330D6ef7BEF07730Bac685', 
    pointsPerNFT: 1, 
    galleryIndex: 2,
    image: 'https://static.drip.trade/collections/hypurr_pfp.jpg'
  },
  { 
    name: 'Hyperian Genesis', 
    address: '0xB0F82655F249FC6561A94eB370d41bD24A861A9d', 
    pointsPerNFT: 1, 
    galleryIndex: 3,
    image: 'https://static.drip.trade/collections/hyperian-genesis_pfp.png'
  },
  // ‚úÖ CATKITSUNE HOZZ√ÅADVA
  { 
    name: 'CatKitSune', 
    address: '0x2abF2969E5e9cAAa1D3fF3DF4265dFFcda0D8353', 
    pointsPerNFT: 1, 
    galleryIndex: 4,
    image: 'https://pbs.twimg.com/profile_images/1882772558825062400/ygJpAGKM_400x400.jpg'
  },
  { 
    name: 'Illumeownati by Catbal', 
    address: '0xDdaB956F9EeE629510B4410627cd63C0448A78aB', 
    pointsPerNFT: 1, 
    galleryIndex: 5,
    image: 'https://static.drip.trade/collections/illumeownati_pfp.png'
  },
  { 
    name: 'PiP & Friends', 
    address: '0xbc4a26ba78ce05E8bCbF069Bbb87FB3E1dAC8DF8', 
    pointsPerNFT: 1, 
    galleryIndex: 6,
    image: 'https://static.drip.trade/collections/pip_pfp.jpg'
  },
  { 
    name: 'Hypers', 
    address: '0x8A3bda085fD13E71FA2851D7a4b4B8af9671c5aB', 
    pointsPerNFT: 1, 
    galleryIndex: 7,
    image: 'https://static.drip.trade/collections/hypers_pfp.png'
  },
  { 
    name: 'Mechacats', 
    address: '0xeA8Cc2a7da4E91c559514B8192eF1cfe1497AC74', 
    pointsPerNFT: 1, 
    galleryIndex: 8,
    image: 'https://static.drip.trade/collections/mechacats_pfp.png'
  },
  { 
    name: 'LQnians', 
    address: '0xfD43e36a9D4002C54a84DAB089a2EdE92ffB5C60', 
    pointsPerNFT: 1, 
    galleryIndex: 9,
    image: 'https://static.drip.trade/collections/lqna_pfp.png'
  },
  { 
    name: 'bald br√∂thers', 
    address: '0x7d87FfB185Fc27Cbee62468A9b5eA00d538b74A6', 
    pointsPerNFT: 1, 
    galleryIndex: 10,
    image: 'https://static.drip.trade/collections/bald-brothers_pfp.png'
  },
  { 
    name: 'BAE', 
    address: '0x31ce9E3Fd78B593c2F37f62AE0fa72A23a2472df', 
    pointsPerNFT: 1, 
    galleryIndex: 11,
    image: 'https://static.drip.trade/collections/bae_pfp.png'
  },
  { 
    name: 'Hypo', 
    address: '0x9583b5632372F50e949361df977464D619b2f826', 
    pointsPerNFT: 1, 
    galleryIndex: 12,
    image: 'https://static.drip.trade/collections/hypo_pfp.png'
  },
  { 
    name: 'Hyperian Legacy', 
    address: '0x05fC042966C40f6cA96e226221B4c699593f4645', 
    pointsPerNFT: 1, 
    galleryIndex: 13,
    image: 'https://static.drip.trade/collections/hyperian-legacy_pfp.png'
  },
  { 
    name: 'Odd Otties', 
    address: '0x43A9652E2B3cE8970e8d33d8C34252a59a6596Aa', 
    pointsPerNFT: 1, 
    galleryIndex: 14,
    image: 'https://static.drip.trade/collections/odd-otties_pfp.png'
  }
];

const HYPERLIQUID_RPC = 'https://rpc.hyperliquid.xyz/evm';
const ERC721_ABI = [
  'function balanceOf(address owner) view returns (uint256)',
  'function tokenURI(uint256 tokenId) view returns (string)',
  'function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)'
];

// ==========================================
// VIEW SWITCHING
// ==========================================
function showView(event, viewName) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.top-nav-btn').forEach(btn => btn.classList.remove('active'));
  document.getElementById('view-' + viewName).classList.add('active');
  if (event && event.target) event.target.classList.add('active');
  
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ==========================================
// WALLET CONNECTION
// ==========================================
async function connectWallet() {
  if (typeof window.ethereum === 'undefined') {
    alert('ü¶ä Please install MetaMask!\n\nDownload: https://metamask.io');
    window.open('https://metamask.io/download/', '_blank');
    return;
  }
  
  try {
    console.log('üîó Requesting wallet connection...');
    
    const accounts = await window.ethereum.request({ 
      method: 'eth_requestAccounts' 
    });
    
    if (accounts.length === 0) {
      showNotification('‚ùå No wallet selected!');
      return;
    }
    
    walletAddress = accounts[0];
    walletConnected = true;
    updateWalletButton();
    loadUserPoints();
    loadNFTData();
    loadStakingData();
    showNotification('‚úÖ Wallet connected!');
    
    console.log('‚úÖ Wallet connected:', walletAddress);
    
    showNotification('üîç Checking NFT balances...');
    await checkNFTBalances();
  } catch (error) {
    console.error('‚ùå Wallet connection error:', error);
    if (error.code === 4001) {
      showNotification('‚ùå Connection rejected');
    } else {
      showNotification('‚ùå Error: ' + error.message);
    }
  }
}

function disconnectWallet() {
  walletConnected = false;
  walletAddress = '';
  document.getElementById('walletText').textContent = 'Connect Wallet';
  document.getElementById('walletBtn').style.background = '#f9fafb';
  document.getElementById('walletBtn').style.borderColor = '#e5e7eb';
  sessionStorage.removeItem('wallet_address');
  showNotification('üëã Wallet disconnected');
}

function updateWalletButton() {
  const shortAddress = walletAddress.slice(0, 6) + '...' + walletAddress.slice(-4);
  document.getElementById('walletText').textContent = shortAddress;
  document.getElementById('walletBtn').style.background = 'linear-gradient(135deg, #e2d6ff, #d6f5e3)';
  document.getElementById('walletBtn').style.borderColor = '#6a3df5';
  sessionStorage.setItem('wallet_address', walletAddress);
}

function toggleWallet() {
  if (walletConnected) {
    if (confirm('üîå Disconnect wallet?')) disconnectWallet();
  } else {
    connectWallet();
  }
}

// ==========================================
// TWITTER LOGIN
// ==========================================
function loginWithTwitter() {
  window.location.href = "https://catkitsune.xyz/api/twitter-login";
}

async function loadTwitterUser() {
  const urlParams = new URLSearchParams(window.location.search);
  const name = urlParams.get('name');
  const username = urlParams.get('username');
  const avatar = urlParams.get('avatar');
  
  if (username && avatar) {
    const decodedAvatar = decodeURIComponent(avatar);
    const decodedUsername = decodeURIComponent(username);
    const decodedName = name ? decodeURIComponent(name) : decodedUsername;
    
    document.getElementById('twitterBtn').style.display = 'none';
    const av = document.getElementById('twitterAvatar');
    av.innerHTML = `
      <img src="${decodedAvatar}" style="width:30px;height:30px;border-radius:50%;border:2px solid #1da1f2;">
      <span style="font-weight:600;">@${decodedUsername}</span>
    `;
    av.style.display = 'flex';
    
    sessionStorage.setItem('twitter_user', JSON.stringify({
      name: decodedName,
      username: decodedUsername,
      avatar: decodedAvatar
    }));
    
    showNotification(`üê¶ Logged in as @${decodedUsername}`);
    console.log('‚úÖ Twitter OAuth success:', decodedUsername);
    
    window.history.replaceState({}, document.title, window.location.pathname);
    return;
  }
  
  const savedUser = sessionStorage.getItem('twitter_user');
  if (savedUser) {
    try {
      const user = JSON.parse(savedUser);
      document.getElementById('twitterBtn').style.display = 'none';
      const av = document.getElementById('twitterAvatar');
      av.innerHTML = `
        <img src="${user.avatar}" style="width:30px;height:30px;border-radius:50%;border:2px solid #1da1f2;">
        <span style="font-weight:600;">@${user.username}</span>
      `;
      av.style.display = 'flex';
      console.log('‚úÖ Loaded saved Twitter user:', user.username);
    } catch (e) {
      console.error('Error loading Twitter user:', e);
    }
  }
}

// ==========================================
// QUESTS
// ==========================================
function completeQuest(element, points) {
  if (!questsLive) {
    showNotification('‚ö†Ô∏è Quests are in testing phase - no points earned yet');
    return;
  }
  
  const checkbox = element.querySelector('.mission-check');
  if (checkbox.classList.contains('completed')) return;
  
  checkbox.classList.add('completed');
  element.style.opacity = '0.7';
  element.style.pointerEvents = 'none';
  
  totalPoints += points;
  completedCount++;
  
  document.getElementById('totalPoints').textContent = totalPoints;
  document.getElementById('completedQuests').textContent = completedCount;
  
  saveUserPoints();
  
  showNotification(`+${points} EP earned! üéâ`);
}

// ==========================================
// NOTIFICATIONS
// ==========================================
function showNotification(message) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed; top: 80px; right: 20px;
    background: linear-gradient(135deg, #6a3df5, #22c55e);
    color: white; padding: 12px 20px; border-radius: 12px;
    font-weight: 600; font-size: 14px; z-index: 1000;
    box-shadow: 0 10px 30px rgba(106, 61, 245, 0.3);
  `;
  notification.textContent = message;
  document.body.appendChild(notification);
  setTimeout(() => notification.remove(), 3000);
}

// ==========================================
// USER POINTS SAVE/LOAD
// ==========================================
function saveUserPoints() {
  if (!walletAddress) return;
  
  const userDataKey = `user_points_${walletAddress}`;
  const userData = {
    address: walletAddress,
    totalPoints: totalPoints,
    completedQuests: completedCount,
    lastUpdated: Date.now()
  };
  
  localStorage.setItem(userDataKey, JSON.stringify(userData));
  console.log(`üíæ Points saved locally for ${walletAddress}: ${totalPoints} EP`);
  
  if (firebaseEnabled && database) {
    const userRef = database.ref('users/' + walletAddress);
    userRef.set({
      address: walletAddress,
      points: totalPoints,
      completedQuests: completedCount,
      lastUpdated: Date.now()
    }).then(() => {
      console.log(`üî• Points synced to Firebase: ${totalPoints} EP`);
    }).catch((error) => {
      console.error('‚ùå Firebase sync error:', error);
    });
  }
}

async function loadUserPoints() {
  if (!walletAddress) return;
  
  const userDataKey = `user_points_${walletAddress}`;
  
  if (firebaseEnabled && database) {
    try {
      const userRef = database.ref('users/' + walletAddress);
      const snapshot = await userRef.once('value');
      
      if (snapshot.exists()) {
        const userData = snapshot.val();
        totalPoints = userData.points || 0;
        completedCount = userData.completedQuests || 0;
        
        document.getElementById('totalPoints').textContent = totalPoints;
        document.getElementById('completedQuests').textContent = completedCount;
        
        console.log(`üî• Points loaded from Firebase: ${totalPoints} EP`);
        
        localStorage.setItem(userDataKey, JSON.stringify({
          address: walletAddress,
          totalPoints: totalPoints,
          completedQuests: completedCount,
          lastUpdated: Date.now()
        }));
        
        return;
      }
    } catch (error) {
      console.error('‚ùå Firebase load error:', error);
    }
  }
  
  const savedData = localStorage.getItem(userDataKey);
  
  if (savedData) {
    try {
      const userData = JSON.parse(savedData);
      totalPoints = userData.totalPoints || 0;
      completedCount = userData.completedQuests || 0;
      
      document.getElementById('totalPoints').textContent = totalPoints;
      document.getElementById('completedQuests').textContent = completedCount;
      
      console.log(`üìÇ Points loaded from localStorage: ${totalPoints} EP`);
    } catch (e) {
      console.error('Error loading user points:', e);
    }
  }
}

// ==========================================
// LEADERBOARD
// ==========================================
let leaderboardData = [];
let filteredQuestsData = [];

async function loadLeaderboardFromFirebase() {
  if (!firebaseEnabled || !database) {
    console.warn('‚ö†Ô∏è Firebase not enabled, using empty leaderboard');
    leaderboardData = [];
    filteredQuestsData = [];
    generateQuestsLeaderboard();
    return;
  }
  
  try {
    const usersRef = database.ref('users');
    const snapshot = await usersRef.once('value');
    
    if (snapshot.exists()) {
      const users = snapshot.val();
      leaderboardData = [];
      
      Object.keys(users).forEach(walletAddr => {
        const user = users[walletAddr];
        leaderboardData.push({
          name: walletAddr.substring(0, 6) + '...' + walletAddr.substring(walletAddr.length - 4),
          address: walletAddr,
          points: user.points || 0,
          avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${walletAddr}`
        });
      });
      
      leaderboardData.sort((a, b) => b.points - a.points);
      filteredQuestsData = [...leaderboardData];
      
      console.log(`üî• Loaded ${leaderboardData.length} users from Firebase`);
    } else {
      console.log('üìä No users in Firebase yet');
      leaderboardData = [];
      filteredQuestsData = [];
    }
    
    generateQuestsLeaderboard();
    
  } catch (error) {
    console.error('‚ùå Error loading leaderboard from Firebase:', error);
    leaderboardData = [];
    filteredQuestsData = [];
    generateQuestsLeaderboard();
  }
}

function setupLeaderboardListener() {
  if (!firebaseEnabled || !database) return;
  
  const usersRef = database.ref('users');
  
  usersRef.on('value', (snapshot) => {
    if (snapshot.exists()) {
      const users = snapshot.val();
      leaderboardData = [];
      
      Object.keys(users).forEach(walletAddr => {
        const user = users[walletAddr];
        leaderboardData.push({
          name: walletAddr.substring(0, 6) + '...' + walletAddr.substring(walletAddr.length - 4),
          address: walletAddr,
          points: user.points || 0,
          avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${walletAddr}`
        });
      });
      
      leaderboardData.sort((a, b) => b.points - a.points);
      filteredQuestsData = [...leaderboardData];
      
      generateQuestsLeaderboard();
      
      console.log('üîÑ Leaderboard updated in real-time');
    }
  });
}

function generateQuestsLeaderboard() {
  const container = document.getElementById('questsLeaderboardRows');
  if (!container) {
    console.error('‚ùå Leaderboard container not found!');
    return;
  }
  
  const currentUser = walletAddress ? walletAddress.toLowerCase() : '';
  filteredQuestsData.sort((a, b) => b.points - a.points);
  
  console.log('‚úÖ Generating leaderboard:', filteredQuestsData.length, 'players');
  
  if (filteredQuestsData.length === 0) {
    container.innerHTML = `
      <div style="padding:40px 20px;text-align:center;color:#6b7280;">
        <div style="font-size:48px;margin-bottom:12px;">üìä</div>
        <div style="font-size:16px;font-weight:600;margin-bottom:8px;">No players yet!</div>
        <div style="font-size:14px;">Be the first to earn points and appear on the leaderboard!</div>
      </div>
    `;
    return;
  }
  
  container.innerHTML = filteredQuestsData.map((player, index) => {
    const rank = index + 1;
    const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : '';
    const isCurrentUser = player.address.toLowerCase() === currentUser;
    
    const shortAddress = player.address.substring(0, 6) + '...' + player.address.substring(player.address.length - 4);
    
    return `
      <div style="display:grid;grid-template-columns:80px 2fr 1fr;gap:12px;padding:14px 16px;border-bottom:1px solid #f3f4f6;font-size:13px;align-items:center;${isCurrentUser ? 'background:#f2ecff;border-left:3px solid #6a3df5;' : ''}">
        <div style="font-weight:700;">
          ${medal ? `<span style="font-size:18px;">${medal}</span>` : `#${rank}`}
        </div>
        <div style="font-weight:600;display:flex;align-items:center;gap:6px;">
          <img src="${player.avatar}" style="width:24px;height:24px;border-radius:50%;">
          ${shortAddress}
        </div>
        <div style="text-align:right;font-weight:700;color:#6a3df5;">${player.points} EP</div>
      </div>
    `;
  }).join('');
  
  console.log('‚úÖ Leaderboard generated!');
}

function filterQuestsLeaderboard() {
  const searchTerm = document.getElementById('questsLeaderboardSearch').value.toLowerCase();
  
  if (!searchTerm) {
    filteredQuestsData = [...leaderboardData];
  } else {
    filteredQuestsData = leaderboardData.filter(player => 
      player.name.toLowerCase().includes(searchTerm) ||
      player.address.toLowerCase().includes(searchTerm)
    );
  }
  
  generateQuestsLeaderboard();
}

// ==========================================
// NFT BALANCE CHECK
// ==========================================
async function fetchNFTImage(contract, tokenId) {
  try {
    const tokenURI = await contract.tokenURI(tokenId);
    
    let metadataURL = tokenURI;
    if (tokenURI.startsWith('ipfs://')) {
      metadataURL = tokenURI.replace('ipfs://', 'https://ipfs.io/ipfs/');
    }
    
    const response = await fetch(metadataURL);
    const metadata = await response.json();
    
    let imageURL = metadata.image || metadata.image_url;
    if (imageURL && imageURL.startsWith('ipfs://')) {
      imageURL = imageURL.replace('ipfs://', 'https://ipfs.io/ipfs/');
    }
    
    return imageURL;
  } catch (error) {
    console.error('Error fetching NFT image:', error);
    return null;
  }
}

async function checkNFTBalances() {
  if (!walletConnected || !walletAddress) {
    console.log('‚ùå Wallet not connected');
    return;
  }
  
  if (typeof ethers === 'undefined') {
    console.error('‚ùå Ethers.js not loaded!');
    showNotification('‚ùå Web3 library error');
    return;
  }
  
  console.log('üîç Checking NFTs:', walletAddress);
  
  try {
    const provider = new ethers.providers.JsonRpcProvider(HYPERLIQUID_RPC);
    const network = await provider.getNetwork();
    console.log('‚úÖ Connected:', network.name);
    
    let totalNFTs = 0;
    let totalNFTPoints = 0;
    
    for (const collection of NFT_COLLECTIONS) {
      try {
        console.log(`üì¶ ${collection.name}...`);
        const contract = new ethers.Contract(collection.address, ERC721_ABI, provider);
        const balance = await contract.balanceOf(walletAddress);
        const balanceNum = balance.toNumber();
        
        console.log(`‚úÖ ${collection.name}: ${balanceNum}`);
        
        const nftCardContainer = document.querySelector(`[data-nft-index="${collection.galleryIndex}"]`);
        const nftElement = document.getElementById(`nft-${collection.galleryIndex}`);
        
        if (nftCardContainer && nftElement) {
          nftCardContainer.style.display = 'flex';
          
          nftElement.textContent = `${balanceNum} owned`;
          
          const nftCard = nftCardContainer.querySelector('.nft-card');
          
          if (balanceNum > 0) {
            nftElement.style.color = '#16a34a';
            nftElement.style.fontWeight = '600';
            
            let nftImageURL = collection.image;
            
            try {
              const tokenId = await contract.tokenOfOwnerByIndex(walletAddress, 0);
              console.log(`üñºÔ∏è Fetching image for token #${tokenId}...`);
              
              const realImage = await fetchNFTImage(contract, tokenId);
              if (realImage) {
                nftImageURL = realImage;
                console.log(`‚úÖ Got real image: ${realImage.substring(0, 50)}...`);
              }
            } catch (e) {
              console.log(`‚ö†Ô∏è Could not fetch real image, using placeholder`);
            }
            
            let img = nftCard.querySelector('.nft-image');
            if (!img) {
              img = document.createElement('img');
              img.className = 'nft-image';
              img.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:10px;position:absolute;top:0;left:0;z-index:0;';
              nftCard.insertBefore(img, nftCard.firstChild);
            }
            img.src = nftImageURL;
            img.alt = collection.name;
            
            img.onerror = () => {
              console.log(`‚ùå Image failed to load, using placeholder`);
              img.src = collection.image;
            };
            
            // ‚úÖ HIDE TEXT WHEN IMAGE EXISTS
            const strong = nftCard.querySelector('strong');
            if (strong) {
              strong.style.display = 'none';
            }
          } else {
            nftElement.style.color = '#6b7280';
            nftElement.style.fontWeight = '400';
            
            const img = nftCard.querySelector('.nft-image');
            if (img) {
              img.remove();
            }
            
            // ‚úÖ SHOW TEXT WHEN NO IMAGE
            const strong = nftCard.querySelector('strong');
            if (strong) {
              strong.style.display = 'block';
              strong.style.position = 'relative';
              strong.style.zIndex = '1';
              strong.style.textShadow = 'none';
              strong.style.color = '#111827';
              strong.style.background = 'none';
              strong.style.padding = '0';
            }
          }
        }
        
        totalNFTs += balanceNum;
      } catch (error) {
        console.error(`‚ùå ${collection.name}:`, error.message);
        
        const nftCardContainer = document.querySelector(`[data-nft-index="${collection.galleryIndex}"]`);
        const nftElement = document.getElementById(`nft-${collection.galleryIndex}`);
        if (nftCardContainer && nftElement) {
          nftCardContainer.style.display = 'flex';
          nftElement.textContent = '0 owned';
          nftElement.style.color = '#6b7280';
        }
      }
    }
    
    console.log(`‚úÖ Total: ${totalNFTs} NFTs found (no EP awarded)`);
    
    saveNFTData();
    
    if (totalNFTs > 0) {
      showNotification(`üéâ ${totalNFTs} NFTs found!`);
    } else {
      showNotification('‚ÑπÔ∏è No NFTs found');
    }
    
  } catch (error) {
    console.error('‚ùå NFT check error:', error);
    showNotification('‚ùå NFT check failed');
  }
}

function saveNFTData() {
  if (!walletAddress) return;
  
  const nftData = {};
  
  for (let i = 0; i < 15; i++) {
    const nftElement = document.getElementById(`nft-${i}`);
    const nftCard = document.querySelector(`[data-nft-index="${i}"]`);
    
    if (nftElement && nftCard) {
      const img = nftCard.querySelector('.nft-image');
      nftData[i] = {
        text: nftElement.textContent,
        color: nftElement.style.color,
        fontWeight: nftElement.style.fontWeight,
        imageUrl: img ? img.src : null
      };
    }
  }
  
  localStorage.setItem(`nft_data_${walletAddress}`, JSON.stringify(nftData));
  console.log(`üíæ NFT data saved for ${walletAddress}`);
}

function loadNFTData() {
  if (!walletAddress) return;
  
  const savedData = localStorage.getItem(`nft_data_${walletAddress}`);
  
  if (!savedData) {
    console.log('üìÇ No saved NFT data found');
    return;
  }
  
  try {
    const nftData = JSON.parse(savedData);
    
    for (let i = 0; i < 15; i++) {
      if (!nftData[i]) continue;
      
      const nftElement = document.getElementById(`nft-${i}`);
      const nftCardContainer = document.querySelector(`[data-nft-index="${i}"]`);
      
      if (nftElement && nftCardContainer) {
        const nftCard = nftCardContainer.querySelector('.nft-card');
        
        nftCardContainer.style.display = 'flex';
        
        nftElement.textContent = nftData[i].text;
        nftElement.style.color = nftData[i].color;
        nftElement.style.fontWeight = nftData[i].fontWeight;
        
        if (nftData[i].imageUrl && nftCard) {
          let img = nftCard.querySelector('.nft-image');
          if (!img) {
            img = document.createElement('img');
            img.className = 'nft-image';
            img.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:10px;position:absolute;top:0;left:0;z-index:0;';
            nftCard.insertBefore(img, nftCard.firstChild);
          }
          img.src = nftData[i].imageUrl;
          
          // ‚úÖ HIDE TEXT WHEN IMAGE EXISTS
          const strong = nftCard.querySelector('strong');
          if (strong) {
            strong.style.display = 'none';
          }
        } else {
          // ‚úÖ SHOW TEXT WHEN NO IMAGE
          const strong = nftCard.querySelector('strong');
          if (strong) {
            strong.style.display = 'block';
          }
        }
      }
    }
    
    console.log(`üìÇ NFT data loaded for ${walletAddress}`);
  } catch (e) {
    console.error('Error loading NFT data:', e);
  }
}

// ==========================================
// INIT
// ==========================================
window.onload = function() {
  console.log('üöÄ CatKitSune loading...');
  loadTwitterUser();
  
  if (firebaseEnabled) {
    loadLeaderboardFromFirebase();
    setupLeaderboardListener();
  } else {
    generateQuestsLeaderboard();
  }
  
  const savedWallet = sessionStorage.getItem('wallet_address');
  if (savedWallet && typeof window.ethereum !== 'undefined') {
    walletAddress = savedWallet;
    walletConnected = true;
    updateWalletButton();
    loadUserPoints();
    loadNFTData();
  }
  
  console.log('‚úÖ Ready!');
};

// ==========================================
// STAKING FUNCTIONS
// ==========================================
let stakedNFTs = {
  series1: [null, null, null, null, null],
  series2: [null, null, null, null, null],
  series3: [null, null, null, null, null]
};

const MAX_NFTS_PER_SERIES = 5;

// Series ranges: Series 1 = ID 1-100, Series 2 = ID 101-200, Series 3 = ID 201-300
function getSeriesFromTokenId(tokenId) {
  const id = parseInt(tokenId);
  if (id >= 1 && id <= 100) return 1;
  if (id >= 101 && id <= 200) return 2;
  if (id >= 201 && id <= 300) return 3;
  return null;
}

function loadStakingData() {
  if (!walletAddress) return;
  
  const saved = localStorage.getItem(`staking_${walletAddress}`);
  if (saved) {
    stakedNFTs = JSON.parse(saved);
    updateStakingUI();
  }
  
  // Auto-check NFTs when loading staking page
  if (walletConnected) {
    checkCatKitSuneNFTs();
  }
}

async function checkCatKitSuneNFTs() {
  if (!walletConnected) return;
  
  const CATKITSUNE_CONTRACT = '0x2abF2969E5e9cAAa1D3fF3DF4265dFFcda0D8353';
  const provider = new ethers.providers.Web3Provider(window.ethereum);
  
  try {
    console.log('üîç Checking CatKitSune NFTs for wallet:', walletAddress);
    
    const contract = new ethers.Contract(CATKITSUNE_CONTRACT, ERC721_ABI, provider);
    const balance = await contract.balanceOf(walletAddress);
    
    console.log(`üìä Total CatKitSune NFTs owned: ${balance.toString()}`);
    
    if (balance.toNumber() > 0) {
      console.log('üìã Listing all owned NFTs:');
      for (let i = 0; i < balance; i++) {
        const tokenId = await contract.tokenOfOwnerByIndex(walletAddress, i);
        const series = getSeriesFromTokenId(tokenId.toString());
        console.log(`  - NFT #${tokenId.toString()} ‚Üí Series ${series}`);
      }
    }
  } catch (error) {
    console.error('‚ùå Error checking CatKitSune NFTs:', error);
  }
}

function saveStakingData() {
  if (!walletAddress) return;
  localStorage.setItem(`staking_${walletAddress}`, JSON.stringify(stakedNFTs));
}

async function stakeToSlot(seriesNumber, slotIndex) {
  if (!walletConnected) {
    showNotification('‚ö†Ô∏è Please connect wallet first!');
    return;
  }
  
  const seriesKey = `series${seriesNumber}`;
  
  // Check if slot is already filled - if yes, do nothing (only X button can unstake)
  if (stakedNFTs[seriesKey][slotIndex] !== null) {
    showNotification('‚ö†Ô∏è Slot is already filled! Use the X button to unstake.');
    return;
  }
  
  // Get user's NFTs from this series
  const provider = new ethers.providers.Web3Provider(window.ethereum);
  let seriesNFTs = [];
  
  try {
    // Check CatKitSune collection only (index 4 in NFT_COLLECTIONS)
    const CATKITSUNE_CONTRACT = '0x2abF2969E5e9cAAa1D3fF3DF4265dFFcda0D8353';
    const collection = NFT_COLLECTIONS.find(c => c.address.toLowerCase() === CATKITSUNE_CONTRACT.toLowerCase());
    
    if (!collection) {
      showNotification('‚ùå CatKitSune contract not found!');
      return;
    }
    
    try {
      const contract = new ethers.Contract(collection.address, ERC721_ABI, provider);
      const balance = await contract.balanceOf(walletAddress);
      
      console.log(`üîç Checking wallet ${walletAddress} for CatKitSune NFTs...`);
      console.log(`üìä Balance: ${balance.toString()} NFTs found`);
      
      for (let i = 0; i < balance; i++) {
        const tokenId = await contract.tokenOfOwnerByIndex(walletAddress, i);
        const series = getSeriesFromTokenId(tokenId.toString());
        
        console.log(`‚úÖ Found NFT #${tokenId.toString()} - Series ${series}`);
        
        // Check if this NFT is already staked in any slot
        const isStaked = stakedNFTs[seriesKey].some(nft => nft && nft.tokenId === tokenId.toString());
        
        if (series === seriesNumber && !isStaked) {
          seriesNFTs.push({
            contract: collection.address,
            tokenId: tokenId.toString(),
            collection: collection.name,
            series: series
          });
        }
      }
    } catch (err) {
      console.error(`‚ùå Error checking ${collection.name}:`, err);
      showNotification(`‚ùå Error checking NFTs: ${err.message}`);
    }
    
    if (seriesNFTs.length === 0) {
      console.warn(`‚ö†Ô∏è No available Series ${seriesNumber} NFTs found!`);
      showNotification(`‚ö†Ô∏è No available Series ${seriesNumber} NFTs in your wallet!`);
      return;
    }
    
    console.log(`‚úÖ Found ${seriesNFTs.length} available Series ${seriesNumber} NFTs`);
    
    // Use the first available NFT
    const selectedNFT = seriesNFTs[0];
    
    console.log(`üéØ Staking NFT #${selectedNFT.tokenId} to Series ${seriesNumber}, Slot ${slotIndex}`);
    
    // Stake the NFT to the slot
    stakedNFTs[seriesKey][slotIndex] = selectedNFT;
    
    // Award EP points
    const epEarned = 5;
    totalPoints += epEarned;
    nftPointsEarned += epEarned;
    
    console.log(`üí∞ Awarded ${epEarned} EP. Total: ${totalPoints} EP`);
    
    saveStakingData();
    saveUserData();
    updateStakingUI();
    updatePointsDisplay();
    
    showNotification(`üéâ NFT #${selectedNFT.tokenId} staked to Series ${seriesNumber}! +${epEarned} EP earned!`);
    
  } catch (error) {
    console.error('‚ùå Staking error:', error);
    showNotification(`‚ùå Staking failed: ${error.message}`);
  }
}

function unstakeFromSlot(seriesNumber, slotIndex) {
  const seriesKey = `series${seriesNumber}`;
  
  if (!stakedNFTs[seriesKey][slotIndex]) return;
  
  // Remove NFT from slot
  stakedNFTs[seriesKey][slotIndex] = null;
  
  saveStakingData();
  updateStakingUI();
  
  showNotification(`‚úÖ NFT unstaked from Series ${seriesNumber}!`);
}

function updateStakingUI() {
  // Update total staked count
  let totalStaked = 0;
  totalStaked += stakedNFTs.series1.filter(nft => nft !== null).length;
  totalStaked += stakedNFTs.series2.filter(nft => nft !== null).length;
  totalStaked += stakedNFTs.series3.filter(nft => nft !== null).length;
  
  const totalStakedEl = document.getElementById('totalStaked');
  if (totalStakedEl) totalStakedEl.textContent = `${totalStaked}/15`;
  
  // Update total EP from staking
  const totalStakingEP = document.getElementById('totalStakingEP');
  if (totalStakingEP) totalStakingEP.textContent = nftPointsEarned || 0;
  
  // Update each series
  for (let seriesNum = 1; seriesNum <= 3; seriesNum++) {
    const seriesKey = `series${seriesNum}`;
    const nfts = stakedNFTs[seriesKey] || [];
    const countEl = document.getElementById(`${seriesKey}-count`);
    
    // Update count
    const stakedCount = nfts.filter(nft => nft !== null).length;
    if (countEl) {
      countEl.textContent = `(${stakedCount}/${MAX_NFTS_PER_SERIES})`;
    }
    
    // Update each slot
    for (let slotIndex = 0; slotIndex < MAX_NFTS_PER_SERIES; slotIndex++) {
      const slotEl = document.getElementById(`series${seriesNum}-slot${slotIndex}`);
      const nft = nfts[slotIndex];
      
      if (!slotEl) continue;
      
      if (!nft) {
        // Empty slot
        slotEl.style.background = '#f9fafb';
        slotEl.style.border = '2px dashed #e5e7eb';
        slotEl.style.cursor = 'pointer';
        slotEl.innerHTML = `
          <div style="font-size:32px; opacity:0.3; margin-bottom:8px; transition:all 0.3s;">ü¶ä</div>
          <div style="font-size:12px; color:var(--text-muted); text-align:center; font-weight:600;">Empty Slot</div>
          <div style="font-size:10px; color:var(--primary); text-align:center; margin-top:4px; opacity:0.7;">Click to stake</div>
        `;
        
        // Re-add onclick event (since innerHTML removes it)
        slotEl.onclick = function() {
          stakeToSlot(seriesNum, slotIndex);
        };
        
        // Add hover effect
        slotEl.onmouseenter = function() {
          this.style.background = '#e0f2fe';
          this.style.borderColor = 'var(--primary)';
          this.querySelector('div:first-child').style.opacity = '0.6';
        };
        slotEl.onmouseleave = function() {
          this.style.background = '#f9fafb';
          this.style.borderColor = '#e5e7eb';
          this.querySelector('div:first-child').style.opacity = '0.3';
        };
      } else {
        // Filled slot
        slotEl.style.background = 'linear-gradient(135deg, var(--primary), #8b5cf6)';
        slotEl.style.border = '2px solid var(--primary)';
        slotEl.style.cursor = 'default';
        slotEl.onclick = null; // Remove click event from filled slots
        slotEl.onmouseenter = null;
        slotEl.onmouseleave = null;
        slotEl.innerHTML = `
          <div style="position:relative; width:100%; height:100%;">
            <button onclick="event.stopPropagation(); unstakeFromSlot(${seriesNum}, ${slotIndex})" style="position:absolute; top:-8px; right:-8px; background:#ef4444; color:white; border:none; border-radius:50%; width:28px; height:28px; cursor:pointer; font-size:16px; font-weight:700; display:flex; align-items:center; justify-content:center; z-index:10; box-shadow:0 2px 4px rgba(0,0,0,0.2);">√ó</button>
            <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; color:white;">
              <div style="font-size:32px; margin-bottom:8px;">ü¶ä</div>
              <div style="font-weight:700; font-size:13px;">#${nft.tokenId}</div>
              <div style="font-size:11px; opacity:0.9;">+5 EP</div>
            </div>
          </div>
        `;
      }
    }
  }
}

if (typeof window.ethereum !== 'undefined') {
  window.ethereum.on('accountsChanged', (accounts) => {
    if (accounts.length === 0) {
      disconnectWallet();
    } else if (walletConnected) {
      walletAddress = accounts[0];
      updateWalletButton();
      loadStakingData();
      showNotification('üîÑ Account changed');
    }
  });
}
</script>
</body>
</html>
